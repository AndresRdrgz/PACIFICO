{% extends 'capacitaciones_app/base.html' %}
{% load static %}
{% load dict_filters %}

{% block title %}Mi Progreso{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="fw-bold text-success text-center mb-4">üìà Mi Progreso</h2>

    <div class="table-responsive">
        <table id="tabla-progreso" class="table table-bordered table-hover align-middle table-sm">
            <thead class="table-success">
                <tr>
                    <th>#</th>
                    <th>üìÖ Fecha</th>
                    <th>üìö Curso</th>
                    <th>üìà Progreso</th>
                    <th>‚úÖ M√≥dulos</th>
                    <th>üìÖ Finalizado</th>
                    <th>üïí √öltimo ingreso</th>
                    <th>üìù M√©todo</th>
                </tr>
            </thead>
            <tbody>
                {% for asignacion in asignaciones %}
                    {% with curso=asignacion.curso %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ asignacion.fecha|date:"d/m/Y H:i" }}</td>
                        <td>{{ curso.titulo }}</td>
                        <td>
                            {% with p=progreso|get_item:curso.id %}
                                {% if p %}
                                    <div class="progress">
                                        <div class="progress-bar bg-success" style="width: {{ p.porcentaje }}%">
                                            {{ p.porcentaje }}%
                                        </div>
                                    </div>
                                {% else %}
                                    ‚Äî
                                {% endif %}
                            {% endwith %}
                        </td>
                        <td>
                            {% with p=progreso|get_item:curso.id %}
                                {% if p %}
                                    {{ p.modulos_completados.count }}/{{ curso.modulos.count }}
                                {% else %}
                                    0/{{ curso.modulos.count }}
                                {% endif %}
                            {% endwith %}
                        </td>
                        <td>
                            {% with p=progreso|get_item:curso.id %}
                                {% if p and p.completado %}
                                    {{ p.fecha_completado|date:"d/m/Y" }}
                                {% else %}
                                    ‚Äî
                                {% endif %}
                            {% endwith %}
                        </td>
                        <td>‚Äî</td>
                        <td>{{ asignacion.metodo }}</td>
                    </tr>
                    {% endwith %}
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#tabla-progreso').DataTable({
        language: {
            search: "üîç Buscar:",
            paginate: { previous: "Anterior", next: "Siguiente" },
            info: "Mostrando _START_ a _END_ de _TOTAL_ cursos",
            lengthMenu: "Mostrar _MENU_ cursos"
        },
        pageLength: 10
    });
});
</script>
{% endblock %}
