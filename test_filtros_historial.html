<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Filtros del Historial</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container my-5">
        <h1>üß™ Prueba de Filtros del Historial</h1>
        
        <!-- Formulario de filtros -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>Filtros</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="buscar-historial" placeholder="üîç Buscar en historial...">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="filtro-curso-historial">
                            <option value="">üìö Todos los cursos</option>
                            <option value="Curso A">Curso A</option>
                            <option value="Curso B">Curso B</option>
                            <option value="Curso C">Curso C</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="date" class="form-control" id="filtro-fecha-desde" title="Filtrar asignaciones desde esta fecha">
                        <small class="text-muted">Filtrar desde fecha</small>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-outline-secondary w-100" id="limpiar-filtros-historial">
                            üóëÔ∏è Limpiar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla de prueba -->
        <div class="card">
            <div class="card-body">
                <table id="tabla-historial-completa" class="table table-hover">
                    <thead class="table-success">
                        <tr>
                            <th>#</th>
                            <th>üìÖ Fecha asignaci√≥n</th>
                            <th>üìö Curso</th>
                            <th>üë§ Usuario</th>
                            <th>üë• Grupo</th>
                            <th>üìà Progreso</th>
                            <th>üéØ Estado</th>
                            <th>üìÖ √öltimo acceso</th>
                            <th>‚öôÔ∏è Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>2024-06-20</td>
                            <td>Curso A</td>
                            <td>Juan P√©rez</td>
                            <td>Grupo 1</td>
                            <td>
                                <div class='progress' style='height:18px;'>
                                    <div class='progress-bar bg-success' style='width:100%;'>100%</div>
                                </div>
                            </td>
                            <td>Completado</td>
                            <td>2024-06-21</td>
                            <td>Ver</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2024-06-15</td>
                            <td>Curso B</td>
                            <td>Mar√≠a Garc√≠a</td>
                            <td>Grupo 2</td>
                            <td>
                                <div class='progress' style='height:18px;'>
                                    <div class='progress-bar bg-warning' style='width:75%;'>75%</div>
                                </div>
                            </td>
                            <td>En progreso</td>
                            <td>2024-06-19</td>
                            <td>Ver</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>2024-06-10</td>
                            <td>Curso C</td>
                            <td>Carlos Rodr√≠guez</td>
                            <td>Grupo 1</td>
                            <td>
                                <div class='progress' style='height:18px;'>
                                    <div class='progress-bar bg-danger' style='width:25%;'>25%</div>
                                </div>
                            </td>
                            <td>Iniciado</td>
                            <td>2024-06-11</td>
                            <td>Ver</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>2024-06-22</td>
                            <td>Curso A</td>
                            <td>Ana L√≥pez</td>
                            <td>Grupo 3</td>
                            <td>
                                <div class='progress' style='height:18px;'>
                                    <div class='progress-bar bg-success' style='width:100%;'>100%</div>
                                </div>
                            </td>
                            <td>Completado</td>
                            <td>2024-06-22</td>
                            <td>Ver</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>2024-06-18</td>
                            <td>Curso B</td>
                            <td>Luis Mart√≠n</td>
                            <td>Grupo 2</td>
                            <td>
                                <div class='progress' style='height:18px;'>
                                    <div class='progress-bar bg-warning' style='width:50%;'>50%</div>
                                </div>
                            </td>
                            <td>En progreso</td>
                            <td>2024-06-20</td>
                            <td>Ver</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- √Årea de resultados -->
        <div class="mt-4">
            <div class="alert alert-info">
                <h6>Instrucciones de prueba:</h6>
                <ul>
                    <li>Prueba el <strong>filtro de b√∫squeda</strong> escribiendo nombres de usuarios o cursos</li>
                    <li>Prueba el <strong>filtro de curso</strong> seleccionando un curso espec√≠fico</li>
                    <li>Prueba el <strong>filtro de fecha</strong> seleccionando una fecha (mostrar√° asignaciones desde esa fecha)</li>
                    <li>Usa el bot√≥n <strong>"Limpiar"</strong> para restaurar todos los filtros</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Inicializar DataTable
            window.tablaHistorial = $('#tabla-historial-completa').DataTable({
                responsive: true,
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
                },
                pageLength: 25,
                order: [[1, 'desc']], // Ordenar por fecha descendente por defecto
                columnDefs: [
                    { targets: [5, 8], orderable: false } // No ordenar columnas de progreso y acciones
                ]
            });

            // Configurar filtros del historial
            configurarFiltrosHistorial();
        });

        // üîç Configurar filtros del historial
        function configurarFiltrosHistorial() {
            const buscarInput = document.getElementById('buscar-historial');
            const filtroCurso = document.getElementById('filtro-curso-historial');
            const filtroFecha = document.getElementById('filtro-fecha-desde');
            const btnLimpiar = document.getElementById('limpiar-filtros-historial');

            // Filtro de b√∫squeda general
            if (buscarInput) {
                buscarInput.addEventListener('keyup', function() {
                    const searchTerm = this.value.toLowerCase();
                    
                    if (window.tablaHistorial) {
                        window.tablaHistorial.search(searchTerm).draw();
                    }
                });
            }

            // Filtro por curso
            if (filtroCurso) {
                filtroCurso.addEventListener('change', function() {
                    const cursoSeleccionado = this.value;
                    
                    if (window.tablaHistorial) {
                        if (cursoSeleccionado === '') {
                            // Mostrar todos los cursos
                            window.tablaHistorial.column(2).search('').draw();
                        } else {
                            // Filtrar por curso espec√≠fico
                            window.tablaHistorial.column(2).search(cursoSeleccionado, true, false).draw();
                        }
                    }
                });
            }

            // Filtro por fecha
            if (filtroFecha) {
                filtroFecha.addEventListener('change', function() {
                    const fechaSeleccionada = this.value;
                    
                    if (window.tablaHistorial && fechaSeleccionada) {
                        // Crear funci√≥n de filtro personalizada para fechas
                        $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                            if (settings.nTable.id !== 'tabla-historial-completa') return true;
                            
                            const fechaFila = data[1]; // Columna de fecha
                            const fechaTexto = $(fechaFila).text() || fechaFila; // Extraer texto si es HTML
                            
                            // Convertir fechas a objetos Date para comparaci√≥n
                            const fechaFilaDate = new Date(fechaTexto);
                            const fechaFiltroDate = new Date(fechaSeleccionada);
                            
                            return fechaFilaDate >= fechaFiltroDate;
                        });
                        
                        window.tablaHistorial.draw();
                    } else if (window.tablaHistorial) {
                        // Limpiar filtro personalizado
                        $.fn.dataTable.ext.search.pop();
                        window.tablaHistorial.draw();
                    }
                });
            }

            // Bot√≥n limpiar filtros
            if (btnLimpiar) {
                btnLimpiar.addEventListener('click', function() {
                    // Limpiar campos de filtro
                    if (buscarInput) buscarInput.value = '';
                    if (filtroCurso) filtroCurso.selectedIndex = 0;
                    if (filtroFecha) filtroFecha.value = '';
                    
                    // Limpiar filtros personalizados de DataTable
                    if (window.tablaHistorial) {
                        // Limpiar filtros personalizados de fecha
                        $.fn.dataTable.ext.search = $.fn.dataTable.ext.search.filter(function(fn) {
                            return fn.toString().indexOf('tabla-historial-completa') === -1;
                        });
                        
                        // Limpiar filtros est√°ndar
                        window.tablaHistorial.search('').columns().search('').draw();
                    }
                    
                    // Notificaci√≥n
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
                    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                    alertDiv.innerHTML = `
                        üßπ <strong>Filtros limpiados</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.remove();
                        }
                    }, 2000);
                });
            }
        }
    </script>
</body>
</html>
