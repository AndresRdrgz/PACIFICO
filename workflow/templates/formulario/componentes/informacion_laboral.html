{# formulario/componentes/informacion_laboral.html #}
<div id="informacion-laboral-seccion" class="flex flex-col gap-6">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <!-- Dirección del trabajo -->
    <div class="md:col-span-3">
      <label for="{{ form.trabajo_direccion.id_for_label }}" class="block font-semibold mb-1">Dirección del trabajo</label>
      <div class="flex items-start border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500 pt-1"><i class="fas fa-map-marked-alt"></i></span>
        <textarea
          name="{{ form.trabajo_direccion.html_name }}"
          id="{{ form.trabajo_direccion.id_for_label }}"
          class="flex-1 outline-none bg-transparent resize-none"
          placeholder="Dirección del trabajo"
          rows="3"
        >{{ form.trabajo_direccion.value|default_if_none:'' }}</textarea>
      </div>
      {% if form.trabajo_direccion.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.trabajo_direccion.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Lugar -->
    <div>
      <label for="{{ form.trabajo_lugar.id_for_label }}" class="block font-semibold mb-1">Lugar</label>
      <div class="flex items-center border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500"><i class="fas fa-building"></i></span>
        <input
          type="text"
          name="{{ form.trabajo_lugar.html_name }}"
          id="{{ form.trabajo_lugar.id_for_label }}"
          class="flex-1 outline-none bg-transparent"
          placeholder="Lugar de trabajo"
          value="{{ form.trabajo_lugar.value|default_if_none:'' }}"
        >
      </div>
      {% if form.trabajo_lugar.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.trabajo_lugar.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Cargo Actual -->
    <div>
      <label for="{{ form.trabajo_cargo.id_for_label }}" class="block font-semibold mb-1">Cargo Actual</label>
      <div class="flex items-center border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500"><i class="fas fa-user-tie"></i></span>
        <input
          type="text"
          name="{{ form.trabajo_cargo.html_name }}"
          id="{{ form.trabajo_cargo.id_for_label }}"
          class="flex-1 outline-none bg-transparent"
          placeholder="Cargo actual"
          value="{{ form.trabajo_cargo.value|default_if_none:'' }}"
        >
      </div>
      {% if form.trabajo_cargo.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.trabajo_cargo.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Salario -->
    <div>
      <label for="{{ form.salario.id_for_label }}" class="block font-semibold mb-1">Salario</label>
      <div class="flex items-center border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500"><i class="fas fa-dollar-sign"></i></span>
        <input
          type="number"
          step="0.01"
          name="{{ form.salario.html_name }}"
          id="{{ form.salario.id_for_label }}"
          class="flex-1 outline-none bg-transparent"
          placeholder="Salario"
          value="{{ form.salario.value|default_if_none:'' }}"
        >
      </div>
      {% if form.salario.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.salario.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Tipo de Trabajo -->
    <div>
      <label for="{{ form.tipo_trabajo.id_for_label }}" class="block font-semibold mb-1">Tipo de Trabajo</label>
      <div class="flex items-center border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500"><i class="fas fa-briefcase"></i></span>
        {{ form.tipo_trabajo }}
      </div>
      {% if form.tipo_trabajo.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.tipo_trabajo.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Origen de los Fondos -->
    <div>
      <label for="{{ form.origen_fondos.id_for_label }}" class="block font-semibold mb-1">Origen de los Fondos</label>
      <div class="flex items-center border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500"><i class="fas fa-wallet"></i></span>
        {{ form.origen_fondos }}
      </div>
      {% if form.origen_fondos.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.origen_fondos.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Frecuencia de Pago -->
    <div>
      <label for="{{ form.frecuencia_pago.id_for_label }}" class="block font-semibold mb-1">Frecuencia</label>
      <div class="flex items-center border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500"><i class="fas fa-calendar-alt"></i></span>
        {{ form.frecuencia_pago }}
      </div>
      {% if form.frecuencia_pago.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.frecuencia_pago.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Teléfono de trabajo -->
    <div>
      <label for="{{ form.tel_trabajo.id_for_label }}" class="block font-semibold mb-1">Teléfono de Trabajo</label>
      <div class="flex items-center border rounded-lg bg-white px-3 py-2">
        <span class="mr-2 text-green-500"><i class="fas fa-phone"></i></span>
        <input
          type="text"
          name="{{ form.tel_trabajo.html_name }}"
          id="{{ form.tel_trabajo.id_for_label }}"
          class="flex-1 outline-none bg-transparent"
          placeholder="0000-0000"
          value="{{ form.tel_trabajo.value|default_if_none:'' }}"
        >
      </div>
      {% if form.tel_trabajo.errors %}
        <div class="text-red-600 text-xs mt-1">{{ form.tel_trabajo.errors|striptags }}</div>
      {% endif %}
    </div>

    <!-- Extensión y Fecha de inicio de trabajo en una sola fila de 2 columnas -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-2">

      <!-- Extensión -->
      <div>
        <label for="{{ form.tel_ext.id_for_label }}" class="block font-semibold mb-1">Extensión</label>
        <div class="flex items-center border rounded-lg bg-white px-3 py-2">
          <span class="mr-2 text-green-500"><i class="fas fa-phone-alt"></i></span>
          <input
            type="text"
            name="{{ form.tel_ext.html_name }}"
            id="{{ form.tel_ext.id_for_label }}"
            class="flex-1 outline-none bg-transparent"
            placeholder="Extensión"
            value="{{ form.tel_ext.value|default_if_none:'' }}"
          >
        </div>
        {% if form.tel_ext.errors %}
          <div class="text-red-600 text-xs mt-1">{{ form.tel_ext.errors|striptags }}</div>
        {% endif %}
      </div>
      <!-- Fecha de inicio de trabajo -->
      <div>
        <label for="{{ form.fecha_inicio_trabajo.id_for_label }}" class="block font-semibold mb-1">Fecha de inicio de trabajo</label>
        <div class="flex items-center border rounded-lg bg-white px-3 py-2">
          <span class="mr-2 text-green-500"><i class="fas fa-calendar-alt"></i></span>
          <input
            type="date"
            name="{{ form.fecha_inicio_trabajo.html_name }}"
            id="{{ form.fecha_inicio_trabajo.id_for_label }}"
            class="flex-1 outline-none bg-transparent"
            value="{{ form.fecha_inicio_trabajo.value|default_if_none:'' }}"
          >
        </div>
        {% if form.fecha_inicio_trabajo.errors %}
          <div class="text-red-600 text-xs mt-1">{{ form.fecha_inicio_trabajo.errors|striptags }}</div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Toggle + Sección de otros ingresos -->
  <div class="mt-6">
    <div class="p-4 rounded-lg shadow-sm bg-white border-l-4 border-green-500 flex flex-col md:flex-row items-start md:items-center gap-3">
      <div class="flex items-center gap-3 flex-1">
        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-green-100 text-green-600 text-xl">
          <i class="fas fa-coins text-green-500"></i>
        </span>
        <label class="font-semibold text-lg block" for="otros_ingresos_toggle" style="color:#009c3c;">
          ¿Tiene otros ingresos?
        </label>
      </div>
      <div class="flex items-center mt-3 md:mt-0">
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" id="otros_ingresos_toggle" class="sr-only peer">
          <div class="w-14 h-7 bg-gray-200 rounded-full peer peer-checked:bg-green-500 transition-all duration-200"></div>
          <div class="absolute left-1 top-1 w-5 h-5 bg-white rounded-full shadow peer-checked:translate-x-7 transition-transform duration-200"></div>
        </label>
        <span id="otros_ingresos_label" class="ml-4 text-base font-medium text-gray-700">No</span>
      </div>
      <input type="checkbox" name="tiene_otros_ingresos" id="otros_ingresos_hidden" value="true" class="hidden">
      <span class="text-gray-500 text-sm">Activa el interruptor si tienes otros ingresos</span>
    </div>
  </div>

  <div id="otros-ingresos-section" class="transition-all duration-300 mt-4" style="display:none;">
    <div class="bg-gray-50 rounded-xl p-6 shadow-inner border border-green-100">
      {{ otros_ingresos_formset.management_form }}
      {% for form in otros_ingresos_formset %}
        <div class="mb-6 pb-3 border-b border-gray-200">
          <h5 class="text-green-600 font-semibold mb-3 flex items-center">
            <i class="fas fa-coins mr-2 text-green-500"></i> Otro Ingreso {{ forloop.counter }}
          </h5>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label for="{{ form.tipo_ingreso.id_for_label }}" class="block font-semibold mb-1">Tipo de Ingreso</label>
              {{ form.tipo_ingreso }}
              {% if form.tipo_ingreso.errors %}
                <div class="text-red-600 text-xs mt-1">{{ form.tipo_ingreso.errors|striptags }}</div>
              {% endif %}
            </div>
            <div>
              <label for="{{ form.fuente.id_for_label }}" class="block font-semibold mb-1">Fuente</label>
              {{ form.fuente }}
              {% if form.fuente.errors %}
                <div class="text-red-600 text-xs mt-1">{{ form.fuente.errors|striptags }}</div>
              {% endif %}
            </div>
            <div>
              <label for="{{ form.monto.id_for_label }}" class="block font-semibold mb-1">Monto mensual</label>
              {{ form.monto }}
              {% if form.monto.errors %}
                <div class="text-red-600 text-xs mt-1">{{ form.monto.errors|striptags }}</div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Toggle Otros Ingresos (igual que PEP)
      const toggleOtros = document.getElementById('otros_ingresos_toggle');
      const otrosSection = document.getElementById('otros-ingresos-section');
      const labelOtros = document.getElementById('otros_ingresos_label');
      const otrosHidden = document.getElementById('otros_ingresos_hidden');

      // Detecta si hay algún valor en los forms de otros ingresos
      let showOtros = false;
      {% for form in otros_ingresos_formset %}
        {% if form.fuente.value or form.monto.value %}
          showOtros = true;
        {% endif %}
      {% endfor %}

      // Inicializa el estado del toggle y la sección
      if (showOtros) {
        toggleOtros.checked = true;
        otrosHidden.checked = true;
        otrosSection.style.display = 'block';
        labelOtros.textContent = 'Sí';
      } else {
        toggleOtros.checked = false;
        otrosHidden.checked = false;
        otrosSection.style.display = 'none';
        labelOtros.textContent = 'No';
      }

      toggleOtros.addEventListener('change', function() {
        otrosHidden.checked = this.checked;
        otrosSection.style.display = this.checked ? 'block' : 'none';
        labelOtros.textContent = this.checked ? 'Sí' : 'No';
      });

      otrosHidden.style.display = 'none';
    });
  </script>
</div>
