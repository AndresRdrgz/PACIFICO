{# formulario/componentes/pep.html #}
<div id="pep-seccion" class="form-section">

  <!-- Interruptor ¿Es PEP? -->
  <div class="row g-4">
    <div class="col-12">
      <div class="p-4 rounded-3 shadow-sm mb-4 bg-white border" style="border-left: 5px solid #00c86b;">

        <label class="fw-semibold mb-2" for="pep_toggle" style="font-size:1.15rem; color:#009c3c;">
          <i class="fas fa-user-shield me-2"></i>¿Es usted una Persona Expuesta Políticamente (PEP)?
        </label>
        <div class="d-flex align-items-center gap-3 mt-2">
          <div class="form-check form-switch" style="font-size:1.2rem;">
            <input class="form-check-input" type="checkbox" id="pep_toggle" style="width:2.5em;height:1.5em;">
            <label class="form-check-label ms-2" for="pep_toggle" id="pep_label" style="font-size:1.08rem; color:#444;">No</label>
          </div>
          <span class="text-muted" style="font-size:0.98rem;">Activa el interruptor si eres PEP</span>
        </div>
      </div>
    </div>
  </div>


  <!-- Sección PEP (campos) -->
  <div id="pep-fields-section" style="display:none;">
    <div class="row g-4">
      <!-- Ingreso mensual PEP -->
      <div class="col-md-6">
        <label for="{{ form.pep_ingreso.id_for_label }}">Ingreso mensual por cargo PEP</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-dollar-sign text-muted"></i></span>
          <input
            type="number"
            step="0.01"
            name="{{ form.pep_ingreso.html_name }}"
            id="{{ form.pep_ingreso.id_for_label }}"
            class="form-control"
            placeholder="Ingreso mensual"
            value="{{ form.pep_ingreso.value|default_if_none:'' }}"
          >
        </div>
        {% if form.pep_ingreso.errors %}
          <div class="text-danger small mt-1">
            {{ form.pep_ingreso.errors|striptags }}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        <label for="{{ form.pep_inicio.id_for_label }}">Fecha de inicio del cargo</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-calendar-alt text-muted"></i></span>
          <input
            type="date"
            name="{{ form.pep_inicio.html_name }}"
            id="{{ form.pep_inicio.id_for_label }}"
            class="form-control"
            value="{{ form.pep_inicio.value|default_if_none:'' }}"
          >
        </div>
        {% if form.pep_inicio.errors %}
          <div class="text-danger small mt-1">
            {{ form.pep_inicio.errors|striptags }}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        <label for="{{ form.pep_cargo_actual.id_for_label }}">Cargo actual</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-briefcase text-muted"></i></span>
          <input
            type="text"
            name="{{ form.pep_cargo_actual.html_name }}"
            id="{{ form.pep_cargo_actual.id_for_label }}"
            class="form-control"
            placeholder="Cargo actual"
            value="{{ form.pep_cargo_actual.value|default_if_none:'' }}"
          >
        </div>
        {% if form.pep_cargo_actual.errors %}
          <div class="text-danger small mt-1">
            {{ form.pep_cargo_actual.errors|striptags }}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        <label for="{{ form.pep_fin.id_for_label }}">Fecha de finalización del cargo</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-calendar-alt text-muted"></i></span>
          <input
            type="date"
            name="{{ form.pep_fin.html_name }}"
            id="{{ form.pep_fin.id_for_label }}"
            class="form-control"
            value="{{ form.pep_fin.value|default_if_none:'' }}"
          >
        </div>
        {% if form.pep_fin.errors %}
          <div class="text-danger small mt-1">
            {{ form.pep_fin.errors|striptags }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div style="height: 2rem;"></div>

  <!-- Interruptor ¿Familiar de PEP? SIEMPRE visible debajo del anterior grupo -->
  <div class="row g-4">
    <div class="col-12">
      <div class="p-4 rounded-3 shadow-sm mb-4 bg-white border" style="border-left: 5px solid #00c86b;">

        <label class="fw-semibold mb-2" for="familiar_pep_toggle" style="font-size:1.15rem; color:#009c3c;">
          <i class="fas fa-user-friends me-2"></i>¿Es usted familiar de una persona PEP?
        </label>
        <div class="d-flex align-items-center gap-3 mt-2">
          <div class="form-check form-switch" style="font-size:1.2rem;">
            <input class="form-check-input" type="checkbox" id="familiar_pep_toggle" style="width:2.5em;height:1.5em;">
            <label class="form-check-label ms-2" for="familiar_pep_toggle" id="familiar_pep_label" style="font-size:1.08rem; color:#444;">No</label>
          </div>
          <span class="text-muted" style="font-size:0.98rem;">Activa el interruptor si eres familiar de PEP</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección Familiar de PEP -->
  <div id="familiar-pep-fields-section" style="display:none;">
    <div class="row g-4">
      <!-- Parentesco -->
      <div class="col-md-6">
        <label for="{{ form.parentesco_pep.id_for_label }}">Parentesco</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-user-friends text-muted"></i></span>
          <input
            type="text"
            name="{{ form.parentesco_pep.html_name }}"
            id="{{ form.parentesco_pep.id_for_label }}"
            class="form-control"
            placeholder="Parentesco"
            value="{{ form.parentesco_pep.value|default_if_none:'' }}"
          >
        </div>
        {% if form.parentesco_pep.errors %}
          <div class="text-danger small mt-1">
            {{ form.parentesco_pep.errors|striptags }}
          </div>
        {% endif %}
      </div>

      <!-- Nombre del PEP -->
      <div class="col-md-6">
        <label for="{{ form.nombre_pep.id_for_label }}">Nombre del PEP</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-id-badge text-muted"></i></span>
          <input
            type="text"
            name="{{ form.nombre_pep.html_name }}"
            id="{{ form.nombre_pep.id_for_label }}"
            class="form-control"
            placeholder="Nombre del PEP"
            value="{{ form.nombre_pep.value|default_if_none:'' }}"
          >
        </div>
        {% if form.nombre_pep.errors %}
          <div class="text-danger small mt-1">
            {{ form.nombre_pep.errors|striptags }}
          </div>
        {% endif %}
      </div>

      <!-- Cargo del PEP -->
      <div class="col-md-6">
        <label for="{{ form.cargo_pep.id_for_label }}">Cargo que desempeña</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-briefcase text-muted"></i></span>
          <input
            type="text"
            name="{{ form.cargo_pep.html_name }}"
            id="{{ form.cargo_pep.id_for_label }}"
            class="form-control"
            placeholder="Cargo del PEP"
            value="{{ form.cargo_pep.value|default_if_none:'' }}"
          >
        </div>
        {% if form.cargo_pep.errors %}
          <div class="text-danger small mt-1">
            {{ form.cargo_pep.errors|striptags }}
          </div>
        {% endif %}
      </div>

      <!-- Institución donde labora -->
      <div class="col-md-6">
        <label for="{{ form.institucion_pep.id_for_label }}">Institución donde labora</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-building text-muted"></i></span>
          <input
            type="text"
            name="{{ form.institucion_pep.html_name }}"
            id="{{ form.institucion_pep.id_for_label }}"
            class="form-control"
            placeholder="Institución"
            value="{{ form.institucion_pep.value|default_if_none:'' }}"
          >
        </div>
        {% if form.institucion_pep.errors %}
          <div class="text-danger small mt-1">
            {{ form.institucion_pep.errors|striptags }}
          </div>
        {% endif %}
      </div>

      <!-- Fecha inicio familiar -->
      <div class="col-md-6">
        <label for="{{ form.pep_fam_inicio.id_for_label }}">Fecha de inicio</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-calendar-alt text-muted"></i></span>
          <input
            type="date"
            name="{{ form.pep_fam_inicio.html_name }}"
            id="{{ form.pep_fam_inicio.id_for_label }}"
            class="form-control"
            value="{{ form.pep_fam_inicio.value|default_if_none:'' }}"
          >
        </div>
        {% if form.pep_fam_inicio.errors %}
          <div class="text-danger small mt-1">
            {{ form.pep_fam_inicio.errors|striptags }}
          </div>
        {% endif %}
      </div>

      <!-- Fecha fin familiar -->
      <div class="col-md-6">
        <label for="{{ form.pep_fam_fin.id_for_label }}">Fecha de finalización</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-calendar-alt text-muted"></i></span>
          <input
            type="date"
            name="{{ form.pep_fam_fin.html_name }}"
            id="{{ form.pep_fam_fin.id_for_label }}"
            class="form-control"
            value="{{ form.pep_fam_fin.value|default_if_none:'' }}"
          >
        </div>
        {% if form.pep_fam_fin.errors %}
          <div class="text-danger small mt-1">
            {{ form.pep_fam_fin.errors|striptags }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Modern toggle for PEP
    const pepToggle = document.getElementById('pep_toggle');
    const pepSection = document.getElementById('pep-fields-section');
    const pepLabel = document.getElementById('pep_label');
    const familiarPepToggle = document.getElementById('familiar_pep_toggle');
    const familiarPepSection = document.getElementById('familiar-pep-fields-section');
    const familiarPepLabel = document.getElementById('familiar_pep_label');
    pepToggle.checked = false;
    pepSection.style.display = 'none';
    pepLabel.textContent = 'No';
    familiarPepToggle.checked = false;
    familiarPepSection.style.display = 'none';
    familiarPepLabel.textContent = 'No';

    // Mostrar/ocultar sección PEP
    pepToggle.addEventListener('change', function() {
      if (this.checked) {
        pepSection.style.display = 'block';
        pepLabel.textContent = 'Sí';
        document.getElementById('{{ form.es_pep.id_for_label }}').checked = true;
      } else {
        pepSection.style.display = 'none';
        pepLabel.textContent = 'No';
        document.getElementById('{{ form.es_pep.id_for_label }}').checked = false;
      }
    });

    // Mostrar/ocultar sección familiar PEP
    familiarPepToggle.addEventListener('change', function() {
      if (this.checked) {
        familiarPepSection.style.display = 'block';
        familiarPepLabel.textContent = 'Sí';
        document.getElementById('{{ form.es_familiar_pep.id_for_label }}').checked = true;
      } else {
        familiarPepSection.style.display = 'none';
        familiarPepLabel.textContent = 'No';
        document.getElementById('{{ form.es_familiar_pep.id_for_label }}').checked = false;
      }
    });

    // Sincroniza si ya hay datos cargados
    const pepCheckbox = document.getElementById('{{ form.es_pep.id_for_label }}');
    const familiarPepCheckbox = document.getElementById('{{ form.es_familiar_pep.id_for_label }}');
    if (pepCheckbox.checked) {
      pepSection.style.display = 'block';
      pepToggle.checked = true;
      pepLabel.textContent = 'Sí';
    }
    if (familiarPepCheckbox.checked) {
      familiarPepSection.style.display = 'block';
      familiarPepToggle.checked = true;
      familiarPepLabel.textContent = 'Sí';
    }
    pepCheckbox.style.display = 'none';
    familiarPepCheckbox.style.display = 'none';
  });
</script>
