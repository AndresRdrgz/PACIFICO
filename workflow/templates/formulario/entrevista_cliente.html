{% extends 'base_sinBarra.html' %}

{% block title %}Entrevista de Cliente{% endblock %}

{% block content %}
{% load static %}

<div class="min-h-screen bg-gradient-to-br from-green-600 to-green-900 flex justify-center items-start py-8 px-2">
  <div class="relative bg-white max-w-3xl w-full rounded-2xl border border-gray-200 shadow-xl px-6 md:px-12 py-8 md:py-12 mb-8 transition-all duration-300 group">
    <div class="absolute top-0 left-0 right-0 h-2 rounded-t-2xl bg-gradient-to-r from-green-700 to-green-400"></div>
    <div class="flex flex-col items-center text-center mb-8">
      <img src="{% static 'logoColor.png' %}" alt="Logo Pacífico" class="w-40 h-auto object-cover mb-2" />
      <h2 class="font-bold text-3xl md:text-4xl text-green-700 mb-1 tracking-tight">Entrevista de Cliente</h2>
      <p class="text-green-700 text-base font-medium mb-0">Complete todos los datos a continuación</p>
    </div>
    <div>
      <form method="post" enctype="multipart/form-data" novalidate id="entrevista-form">
        {% csrf_token %}
        {% if form.errors or referencias_formset.errors or referencias_comerciales_formset.errors or otros_ingresos_formset.errors %}
          <div class="rounded-xl font-semibold text-sm bg-red-100 text-red-700 px-6 py-4 mb-6 border border-red-300">
            <strong>Por favor, corrija los campos obligatorios resaltados en rojo.</strong>
            <ul class="mb-0 mt-2 space-y-1 list-disc list-inside">
              {% for field in form %}{% for error in field.errors %}<li>{{ field.label }}: {{ error }}</li>{% endfor %}{% endfor %}
              {% for error in form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
              {% for subform in referencias_formset.forms %}
                {% for field in subform %}
                  {% for error in field.errors %}
                    <li>Referencia Personal {{ forloop.parentloop.counter }} - {{ field.label }}: {{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in subform.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in referencias_formset.non_form_errors %}<li>{{ error }}</li>{% endfor %}
              {% for subform in referencias_comerciales_formset.forms %}
                {% for field in subform %}
                  {% for error in field.errors %}
                    <li>Referencia Comercial {{ forloop.parentloop.counter }} - {{ field.label }}: {{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in subform.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in referencias_comerciales_formset.non_form_errors %}<li>{{ error }}</li>{% endfor %}
              {% for subform in otros_ingresos_formset.forms %}
                {% for field in subform %}
                  {% for error in field.errors %}
                    <li>Otro Ingreso {{ forloop.parentloop.counter }} - {{ field.label }}: {{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in subform.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in otros_ingresos_formset.non_form_errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          </div>
        {% endif %}
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-user-check"></i></span> 1. Datos Generales</h2>
          <!-- Use a single-column layout for all fields below -->
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/datos_generales.html' with form=form %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-map-marker-alt"></i></span> 2. Dirección Residencial</h2>
          <!-- Use a single-column layout for all fields below -->
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/direccion_residencial.html' with form=form %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-users"></i></span> 3. Datos del Cónyuge o Deudor Solidario</h2>
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/conyuge.html' with form=form %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-briefcase"></i></span> 4. Información Laboral y Otros Ingresos</h2>
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/informacion_laboral.html' with form=form otros_ingresos_formset=otros_ingresos_formset %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-user-shield"></i></span> 5. PEP - Persona Expuesta Políticamente</h2>
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/pep.html' with form=form %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-user-friends"></i></span> 6. Referencias Personales</h2>
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/referencias_personales.html' with referencias_formset=referencias_formset %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-briefcase"></i></span> 7. Referencias Comerciales</h2>
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/referencias_comerciales.html' with referencias_comerciales_formset=referencias_comerciales_formset %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-university"></i></span> 8. Datos Bancarios</h2>
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/datos_bancarios.html' with form=form %}
          </div>
        </div>
        <div class="border-t-4 border-green-600 pt-6 mt-8">
          <h2 class="flex items-center gap-2 text-xl md:text-2xl font-bold text-green-700 mb-4 uppercase tracking-wide"><span><i class="fas fa-check-circle"></i></span> 9. Autorizaciones</h2>
          <div class="grid grid-cols-1 gap-4">
            {% include 'formulario/componentes/autorizaciones.html' with form=form %}
          </div>
        </div>
        <div class="text-end mt-8">
          <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-xl shadow-lg font-semibold text-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">Enviar</button>
        </div>
      </form>
      {% if messages %}
        {% for message in messages %}
          <div class="rounded-xl font-bold text-lg bg-green-100 text-green-800 px-6 py-4 mt-6 text-center border border-green-300">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
