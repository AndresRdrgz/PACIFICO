{% load static %}
{% if resultado %}
    
    <div class="flex items-center p-4 mb-3 text-sm rounded-lg bg-green-100 border border-green-400">
        <span class="font-medium text-green-700 inline-block w-2/3">
            âœ… Â¡CÃ¡lculo #{{resultado.numero_cotizacion}} guardado con Ã©xito! Puede modificar esta cotizaciÃ³n editando los parÃ¡metros y haciendo clic en el botÃ³n "Calcular ðŸ’°".
        </span>
        <div class="ml-auto flex space-x-2">
            {% if resultado.numero_cotizacion %}
                <!-- Dropdown button for report options -->
                <div class="relative inline-block text-left">
                    <button type="button" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 inline-flex items-center" id="reportDropdown" onclick="toggleDropdown()">
                        Reporte de Consulta ðŸ“„
                        <svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    
                    <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50 hidden" id="dropdownMenu">
                        <div class="py-1">
                            <a href="{% url 'generate_report_excel' resultado.numero_cotizacion %}" 
                               class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <img src="{% static 'excel.svg' %}" alt="Excel" class="w-4 h-4 mr-2" onerror="this.style.display='none'">
                                ðŸ“Š Descargar como Excel
                            </a>
                            <a href="{% url 'generate_report_pdf' resultado.numero_cotizacion %}" 
                               class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <img src="{% static 'pdf.svg' %}" alt="PDF" class="w-4 h-4 mr-2" onerror="this.style.display='none'">
                                ðŸ“„ Descargar como PDF
                            </a>
                        </div>
                    </div>
                </div>
                
                {% if pruebaFuncionalidades %}
                    <a href="{% url 'download_merged_pdf' resultado.numero_cotizacion %}" class="bg-[#f57722] text-white px-4 py-2 rounded border border-black hover:bg-[#f57722] inline-block">
                        <img src="{% static 'pdf.svg' %}" alt="PDF Icon" class="inline-block w-4 h-4 mr-2">
                        Descargar PDF de consulta
                    </a>
                {% endif %}
            {% else %}
                <span class="text-red-500">NÃºmero de cotizaciÃ³n no disponible.</span>
            {% endif %}
        </div>
    </div>
  


    <div class="flex-1 p-4 border bg-white rounded-lg mb-2">
        <h1 class="text-lg font-bold mb-2">Resultado del CÃ¡lculo</h1>
        <p class="mt-1 text-sm font-normal text-gray-500">Este resultado es una estimaciÃ³n segÃºn los datos ingresados, pueden existir pequeÃ±as diferencias en la rentabilidad con el cÃ¡lculo de APPX.</p>
        
        <div class="overflow-x-auto mt-2">
            <table class="w-full text-sm text-center border text-gray-500 mb-3">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            DESEMBOLSO TOTAL
                        </th>
                        <th scope="col" class="px-6 py-3">
                            RENTABILIDAD (ESTIMADA)
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Tasa de InterÃ©s
                        </th>
                        <th scope="col" class="px-6 py-3">
                            ComisiÃ³n de Cierre
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Plazo
                        </th>
                        <th scope="col" class="px-6 py-3">
                            MONTO LETRA (SIN SEGUROS)
                        </th>
                        <th scope="col" class="px-6 py-3">
                            COLECTIVO DE CRÃ‰DITO (MENSUAL)
                        </th>
                        <th scope="col" class="px-6 py-3">
                            MONTO LETRA APPX (CON COLECTIVO DE CRÃ‰DITO)
                        </th>
                        <th scope="col" class="px-6 py-3">
                            SEGURO DE AUTO (MENSUAL)
                        </th>
                        <th scope="col" class="px-6 py-3 bg-black text-white">
                            Total de la Letra C/Seguro
                        </th>
                        <th scope="col" class="px-6 py-3 bg-black text-white">
                            Total a Pagar
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="bg-white border-b">
                        <td class="px-6 py-4">
                            ${{resultado.auxMonto2}}
                        </td>
                        <td class="px-6 py-4">
                            %{{resultado.r1}} 
                        </td>
                        <td class="px-6 py-4">
                            %{{resultado.tasaEstimada}} 
                        </td>
                        <td class="px-6 py-4">
                            %{{resultado.calcComiCierreFinal}} 
                        </td>
                        <td class="px-6 py-4">
                            {{resultado.auxPlazoPago}} MESES
                        </td>
                        <td class="px-6 py-4">
                            ${{resultado.wrkLetraSinSeguros}}
                        </td>
                        <td class="px-6 py-4">
                            ${{resultado.wrkLetraSeguro}}
                        </td>
                        <td class="px-6 py-4">
                            ${{resultado.wrkMontoLetra}}
                        </td>
                        <td class="px-6 py-4">
                            ${{resultado.montoMensualSeguro}}
                        </td>
                        <td class="px-6 py-4 font-bold text-green-700">
                            ${{resultado.wrkLetraConSeguros}}
                        </td>
                        <td class="px-6 py-4 font-bold text-green-700">
                            ${{resultado.tablaTotalPagos}}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!--Resultado Nivel de Endeudamiento-->
        <h1 class="text-lg font-bold mb-2">Deudor - Nivel de Endeudamiento - Real</h1>
        <p class="mt-1 text-sm font-normal text-gray-500">Nivel calculado segÃºn los parÃ¡metros ingresados. En caso de modificar el abono, debe hacer clic en el botÃ³n Cotizar ðŸ’° de la secciÃ³n "ParÃ¡metros del CÃ¡lculo".</p>
        <div class="overflow-x-auto mt-2">
            <table class="w-full text-sm text-center border text-gray-500 mb-3">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            SALARIO MENSUAL
                        </th>
                        <th scope="col" class="px-6 py-3">
                            TOTAL - DESCUENTOS LEGALES
                        </th>
                        <th scope="col" class="px-6 py-3">
                            TOTAL - DESCUENTO DIRECTO
                        </th>
                        <th scope="col" class="px-6 py-3">
                            TOTAL - PAGO VOLUNTARIO
                        </th>
                        <th scope="col" class="px-6 py-3">
                            SALARIO NETO ACTUAL
                        </th>
                        <th scope="col" class="px-6 py-3">
                            LETRA MENSUAL
                        </th>
                        <th scope="col" class="px-6 py-3">
                            PORCENTAJE DE LETRA
                        </th>
                        <th scope="col" class="px-6 py-3 bg-black text-white">
                            Salario Neto
                        </th>
                        <th scope="col" class="px-6 py-3 bg-black text-white">
                            Nivel de Endeudamiento - Real
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="bg-white border-b">
                        <td class="px-6 py-4">
                            ${{resultado.salarioBaseMensual}}
                        </td>
                        <td class="px-6 py-4 text-red-700">
                            ${{resultado.totalDescuentosLegales}} 
                        </td>
                        <td class="px-6 py-4 text-red-700">
                            ${{resultado.totalDescuentoDirecto}}
                        </td>
                        <td class="px-6 py-4 text-red-700">
                            ${{resultado.totalPagoVoluntario}}
                        </td>
                        <td class="px-6 py-4">
                            ${{resultado.salarioNetoActual}}
                        </td>
                        <td class="px-6 py-4">
                            ${{resultado.wrkLetraConSeguros}}
                        </td>
                        <td class="px-6 py-4">
                            %{{resultado.porcentajeLetraSeguro}}
                        </td>
                        <td class="px-6 py-4 font-bold text-green-700">
                            ${{resultado.salarioNeto}}
                        </td>
                        <td class="px-6 py-4 font-bold text-green-700">
                            %{{resultado.porSalarioNeto}}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
       

          <!--Resultado Nivel de Endeudamiento-->
          <h1 class="text-lg font-bold mb-2">Deudor - Nivel de Endeudamiento - Completo</h1>
          <div class="overflow-x-auto mt-2">
              <table class="w-full text-sm text-center border text-gray-500 mb-3">
                  <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                      <tr>
                          <th scope="col" class="px-6 py-3">
                              SALARIO MENSUAL
                          </th>
                          <th scope="col" class="px-6 py-3">
                             TOTAL - INGRESOS ADICIONALES
                          </th>
                          <th scope="col" class="px-6 py-3">
                              TOTAL - INGRESOS Mensuales
                          </th>
                          <th scope="col" class="px-6 py-3">
                              TOTAL - DESCUENTOS LEGALES
                          </th>
                          <th scope="col" class="px-6 py-3">
                              TOTAL - DESCUENTO DIRECTO
                          </th>
                          <th scope="col" class="px-6 py-3">
                              TOTAL - PAGO VOLUNTARIO
                          </th>
                          <th scope="col" class="px-6 py-3">
                              SALARIO NETO ACTUAL
                          </th>
                          <th scope="col" class="px-6 py-3">
                              LETRA MENSUAL
                          </th>
                          <th scope="col" class="px-6 py-3">
                            PORCENTAJE DE LETRA
                        </th>
                          <th scope="col" class="px-6 py-3 bg-black text-white">
                              Salario Neto
                          </th>
                          <th scope="col" class="px-6 py-3 bg-black text-white">
                              Nivel de Endeudamiento - Completo
                          </th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr class="bg-white border-b">
                          <td class="px-6 py-4">
                              ${{resultado.salarioBaseMensual}}
                          </td>
                          <td class="px-6 py-4">
                              ${{resultado.totalIngresosAdicionales}} 
                          </td>
                          <td class="px-6 py-4">
                              ${{resultado.totalIngresosMensualesCompleto}} 
                          </td>
                          <td class="px-6 py-4 text-red-700">
                              ${{resultado.totalDescuentosLegalesCompleto}} 
                          </td>
                          <td class="px-6 py-4 text-red-700">
                              ${{resultado.totalDescuentoDirecto}}
                          </td>
                          <td class="px-6 py-4 text-red-700">
                              ${{resultado.totalPagoVoluntario}}
                          </td>
                          <td class="px-6 py-4">
                              ${{resultado.salarioNetoActualCompleto}}
                          </td>
                          <td class="px-6 py-4">
                              ${{resultado.wrkLetraConSeguros}}
                          </td>
                          <td class="px-6 py-4">
                            %{{resultado.porcentajeLetraSeguroCompleto}}
                        </td>
                          <td class="px-6 py-4 font-bold text-green-700">
                              ${{resultado.salarioNetoCompleto}}
                          </td>
                          <td class="px-6 py-4 font-bold text-green-700">
                              %{{resultado.porSalarioNetoCompleto}}
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>

          
           <!-- Nivel de endeudamiento codeudor-->
        {% if form.aplicaCodeudor.value == 'si' %}

        {% include 'partials/nivelCodeudor.html' %}

    {% endif %}
          
          <!--Tabla resumen-->
          <h1 class="text-lg font-bold mb-2">Resumen de la CotizaciÃ³n</h1>
            <div class="mt-2 flex items-center justify-start">
                <div class="w-1/3 pr-4">
                    <table class="w-full text-sm text-left border text-gray-500 mb-3">
                        <tbody>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4 font-bold">Nombre</td>
                                <td class="px-6 py-4">{{resultado.nombreCliente}}</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4 font-bold">Valor del Equipo</td>
                                <td class="px-6 py-4">${{resultado.valorAuto}}</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4 font-bold">Abono</td>
                                <td class="px-6 py-4">${{resultado.abono}}</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4 font-bold">Plazo</td>
                                <td class="px-6 py-4">{{resultado.auxPlazoPago}} MESES</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4 font-bold">Letra sin Seguro de Auto</td>
                                <td class="px-6 py-4">${{resultado.wrkMontoLetra}}</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-3 bg-black text-white font-bold">Letra con Seguro de Auto</td>
                                <td class="px-6 py-3 bg-black text-white font-bold">${{resultado.wrkLetraConSeguros}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="w-1/2 flex items-center">
                    <img src="{% static 'logoColor.png' %}" alt="Logo" class="h-auto max-w-full pl-5" style="width: 50%;">
                </div>
            </div>

          


    </div>
    
{% endif %}

<script>
function toggleDropdown() {
    const dropdown = document.getElementById('dropdownMenu');
    dropdown.classList.toggle('hidden');
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('dropdownMenu');
    const button = document.getElementById('reportDropdown');
    
    if (dropdown && button && !button.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.classList.add('hidden');
    }
});
</script>