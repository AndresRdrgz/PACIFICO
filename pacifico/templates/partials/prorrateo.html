 <!-- Prorrateo -->
 <div class="flex-1 p-4 border border-gray-400  rounded-lg mb-2">
 
    

  
    <div class="flex items-center ">
        <h1 class="text-lg font-bold">Prorrateo</h1>
        
        
        <div class="ml-auto">
            <label class="inline-flex items-center ms-5 cursor-pointer">
                <input type="checkbox" id="toggleProrrateo" class="sr-only peer" onchange="toggleProrrateoSection()">
                <div class="relative w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
            </label>
        </div>
    </div>
  <div id="sectionProrrateo" class="flex-1 p-1 rounded-lg mb-1">
    <p class="mt-1 text-sm font-normal text-gray-500">El campo salario es llenado automáticamente al llenar el campo "Ingresos" en la sección "Detalles del Deudor".</p>
    <div class="flex space-x-4">
        <div class="flex-1 mb-4">
            <label for="id_primerMes" class="block text-sm font-medium text-gray-700 mb-1">Seleccione el primer mes</label>
            {{ form.primerMes }}
            <!--<select id="primerMes" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 transition duration-300 ease focus:outline-none focus:border-blue-500 hover:border-gray-300 shadow-sm focus:shadow">
                <option value="" selected disabled>Seleccione un mes</option>
                <option value="0">Enero</option>
                <option value="1">Febrero</option>
                <option value="2">Marzo</option>
                <option value="3">Abril</option>
                <option value="4">Mayo</option>
                <option value="5">Junio</option>
                <option value="6">Julio</option>
                <option value="7">Agosto</option>
                <option value="8">Septiembre</option>
                <option value="9">Octubre</option>
                <option value="10">Noviembre</option>
                <option value="11">Diciembre</option>
            </select>
        -->
           
        </div>
        <div class="flex-1 mb-4">
        <label for="tipoProrrateo" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Prorrateo</label>
        <select id="tipoProrrateo" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 transition duration-300 ease focus:outline-none focus:border-blue-500 hover:border-gray-300 shadow-sm focus:shadow">
            <option value="horas_extras" selected>Horas Extras</option>
            <option value="prima_produccion">Prima de Producción</option>
        </select>
            </div>
            <div class="flex-1 mb-4">
                <label for="prorrateoSalario" class="block text-sm font-medium text-gray-700 mb-1">Salario</label>
                <input type="number" id="prorrateoSalario" name="prorrateoSalario" readonly class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2">
            </div>
    </div>
    
    <div id="prorrateoCampos" class="flex flex-wrap border border-gray-300 rounded-md p-4 mb-4">
        <div class="w-full md:w-1/3 px-2 ">
            <div class="flex-1 mb-4">
                <label for="id_mes0" class="block text-sm font-medium text-gray-700 mb-1">Mes 1</label>
                {{form.mes0}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes1" class="block text-sm font-medium text-gray-700 mb-1">Mes 2</label> 
                {{form.mes1}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes2" class="block text-sm font-medium text-gray-700 mb-1">Mes 3</label> 
                {{form.mes2}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes3" class="block text-sm font-medium text-gray-700 mb-1">Mes 4</label> 
                {{form.mes3}}
            </div>
        </div>
        <div class="w-full md:w-1/3 px-2">
            <div class="flex-1 mb-4">
                <label for="id_mes4" class="block text-sm font-medium text-gray-700 mb-1">Mes 5</label> 
                {{form.mes4}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes5" class="block text-sm font-medium text-gray-700 mb-1">Mes 6</label> 
                {{form.mes5}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes6" class="block text-sm font-medium text-gray-700 mb-1">Mes 7</label> 
                {{form.mes6}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes7" class="block text-sm font-medium text-gray-700 mb-1">Mes 8</label> 
                {{form.mes7}}
            </div>
        </div>
        <div class="w-full md:w-1/3 px-2">
            <div class="flex-1 mb-4">
                <label for="id_mes8" class="block text-sm font-medium text-gray-700 mb-1">Mes 9</label> 
                {{form.mes8}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes9" class="block text-sm font-medium text-gray-700 mb-1">Mes 10</label> 
                {{form.mes9}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes10" class="block text-sm font-medium text-gray-700 mb-1">Mes 11</label>
                {{form.mes10}}
            </div>
            <div class="flex-1 mb-4">
                <label for="id_mes11" class="block text-sm font-medium text-gray-700 mb-1">Mes 12</label>
                {{form.mes11}}
            </div>
        </div>
        
    </div>
    <div class="overflow-x-auto mt-2">
        <table class="w-full text-sm text-center border text-gray-500 mb-3">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3">
                        TOTAL
                    </th>
                    <th scope="col" class="px-6 py-3" id="thEntreDoce">
                        ENTRE CANT. MESES ()
                    </th>
                    <th scope="col" class="px-6 py-3">
                         MENOS SALARIO
                    </th>
                  
                </tr>
            </thead>
            <tbody>
                <tr class="bg-white border-b">
                    <td class="px-6 py-4">
                        <input type="number" id="totalSuma" name="totalSuma" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2" readonly>
                    </td>
                    <td class="px-6 py-4">
                        <input type="number" id="entreDoce" name="entreDoce" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2" readonly>
                    
                    </td>
                    <td class="px-6 py-4">
                        <input type="number" id="menosSalario" name="menosSalario" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2" readonly>
                    
                    </td>
                
                   
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="flex-1 mb-4">
        <button id="calcularSuma" type="button" class="bg-blue-500 text-white px-4 py-2 rounded">Calcular Prorrateo</button>
    </div>
    
    
</div>

   
</div>


<script>
    function validateDecimal(input) {
        const value = input.value;
        const regex = /^\d+(\.\d{0,2})?$/;
        if (!regex.test(value)) {
            input.value = value.slice(0, -1);
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
        const primerMesSelect = document.getElementById('id_primerMes');
        
        const meses = ['ENERO', 'FEBRERO', 'MARZO', 'ABRIL', 'MAYO', 'JUNIO', 'JULIO', 'AGOSTO', 'SEPTIEMBRE', 'OCTUBRE', 'NOVIEMBRE', 'DICIEMBRE'];

        primerMesSelect.addEventListener('change', function() {
            const primerMes = meses.indexOf(primerMesSelect.value.toUpperCase());
            //const primerMes = primerMesSelect.value;
            console.log('Primer mes:', primerMes);
            for (let i = 0; i < 12; i++) {
                const mesIndex = (primerMes - i + 12) % 12;
                document.querySelector(`label[for="id_mes${i}"]`).textContent = `${meses[mesIndex]}`;
            }
        });
        document.getElementById('calcularSuma').addEventListener('click', function() {
            console.log('Calculando suma');
            let total = 0;
            let n_fields = 0;
            for (let i = 0; i < 12; i++) {
            const monto = parseFloat(document.getElementById(`id_mes${i}`).value) || 0;
            //console.log(i," - ", monto);
            if (monto !== 0) {
                n_fields++;
            }
            total += monto; 
            
            }
            console.log("total: ", total,"n_fields: ", n_fields);
            total = Math.round(total * 100) / 100;
            document.getElementById('totalSuma').value = total;
            if (n_fields > 0) {
            var average = total / n_fields;
            average = Math.round((total / n_fields) * 100) / 100;
            document.getElementById('thEntreDoce').textContent = `ENTRE CANT. MESES (${n_fields})`;
            //round 2 decimals average
            
            document.getElementById('entreDoce').value = average;
            //menos salario
            const salario = document.getElementById('id_ingresos').value;
            console.log(salario);
            var resultado = average - salario;
            resultado = Math.round(resultado * 100) / 100;
            
            document.getElementById('menosSalario').value = resultado;

            //if resultado > 0 then set id_horasExtrasMonto or id_primaMonto based on tipoProrrateo and set the value to resultado
            const tipoProrrateo = document.getElementById('tipoProrrateo').value;
            console.log(tipoProrrateo);
            if (resultado > 0) {
                
                if (tipoProrrateo === 'horas_extras') {
                    document.getElementById('id_horasExtrasMonto').value = resultado;
                    document.getElementById('id_horasExtrasDcto').checked = true;

                    document.getElementById('id_primaMonto').value = 0;
                    document.getElementById('id_primaDcto').checked = false;
                } else if (tipoProrrateo === 'prima_produccion') {
                    
                    document.getElementById('id_primaMonto').value = resultado;
                    document.getElementById('id_primaDcto').checked = true;
                    document.getElementById('id_horasExtrasMonto').value = 0;
                    document.getElementById('id_horasExtrasDcto').checked = false;
       
                }


            }
            
        

            tipoProrrateo
            id_horasExtrasMonto
            id_primaMonto
            }
        });
        });

        {% if resultado %}
        function calcularSuma() {
            console.log('Calculando suma');
            let total = 0;
            let n_fields = 0;
            for (let i = 0; i < 12; i++) {
                const monto = parseFloat(document.getElementById(`id_mes${i}`).value) || 0;
                if (monto !== 0) {
                    n_fields++;
                }
                total += monto; 
            }
            console.log("total: ", total,"n_fields: ", n_fields);
            total = Math.round(total * 100) / 100;
            document.getElementById('totalSuma').value = total;
            if (n_fields > 0) {
                var average = total / n_fields;
                average = Math.round((total / n_fields) * 100) / 100;
                document.getElementById('thEntreDoce').textContent = `ENTRE CANT. MESES (${n_fields})`;
                document.getElementById('entreDoce').value = average;
            }
        }
    
        document.getElementById('calcularSuma').addEventListener('click', calcularSuma);
    
        document.addEventListener('DOMContentLoaded', function() {
            calcularSuma();
        });
        {% endif %}
</script>