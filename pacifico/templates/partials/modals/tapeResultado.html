<h3 class="text-lg leading-6 mb-2 font-medium text-gray-900">Resultado TAPE</h3>
<button type="button" class="mb-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none" id="calcularTapeBtn">
    Calcular TAPE
</button>



<h3 class="text-lg leading-6 mb-2 font-medium text-gray-900">DISPONIBLE QUINCENAL PARA EL PRÉSTAMO</h3>
<div class="flex space-x-4" id="sectionDisponibleQuincenal">
    <div class="flex-1 mb-4">
        <label for="tapePorcentaje1" class="block text-sm font-medium text-gray-700 mb-1">Porcentaje (%)</label>
        <div class="relative">
            <input type="number" name="tapePorcentaje1" placeholder="Salario X Porcentaje" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center pr-8" step="0.01" id="tapePorcentaje1" readonly>
            <span class="absolute inset-y-0 right-2 flex items-center text-gray-500 pointer-events-none">%</span>
        </div>
    </div>
    <div class="flex-1 mb-4">
        <label for="tapeSalarioPorcentaje" class="block text-sm font-medium text-gray-700 mb-1">Salario X Porcentaje</label>
        <input type="number" name="tapeSalarioPorcentaje" placeholder="" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapeSalarioPorcentaje" readonly>
    </div>
    <div class="flex-1 mb-4">
        <label for="tapeDisponibleQuincenal" class="block text-sm font-medium text-gray-700 mb-1">Disponible Quincenal</label>
        <input type="number" name="tapeDisponibleQuincenal" placeholder="Disponible Quincenal" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapeDisponibleQuincenal" readonly>
    </div>
</div>
<h3 class="text-lg leading-6 mb-2 font-medium text-gray-900">ANÁLISIS DE SALARIO MÍNIMO POR LEY</h3>
<div class="flex space-x-4" id="sectionMinimoLey">
    <div class="flex-1 mb-4">
        <label for="tapePorcentajeMinimoLey" class="block text-sm font-medium text-gray-700 mb-1">Porcentaje (%)</label>
        <div class="relative">
            <input type="number" name="tapePorcentajeMinimoLey" placeholder="Salario X Porcentaje" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center pr-8" step="0.01" id="tapePorcentajeMinimoLey" readonly>
            <span class="absolute inset-y-0 right-2 flex items-center text-gray-500 pointer-events-none">%</span>
        </div>
    </div>
    <div class="flex-1 mb-4">
        <label for="tapeSalarioMinimoLey" class="block text-sm font-medium text-gray-700 mb-1">Salario X Porcentaje</label>
        <input type="number" name="tapeSalarioMinimoLey" placeholder="" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-right" step="0.01" id="tapeSalarioMinimoLey" readonly>
    </div>
    
    <div class="flex-1 mb-4">
        <label for="tapeSalarioMinimoPorLey" class="block text-sm font-medium text-gray-700 mb-1">Salario Minimo por Ley</label>
        <input type="number" name="tapeSalarioMinimoPorLey" placeholder="Salario Minimo por Ley" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapeSalarioMinimoPorLey" readonly>
    </div>
</div>
<h3 class="text-lg leading-6 mb-2 font-medium text-gray-900">CAPACIDAD QUINCENAL DE DESCUENTO POR EMBARGO</h3>
<div class="flex space-x-4" id="sectionCapacidadDescuentoEmbargo">
     <div class="flex-1 mb-4">
        <label for="tapePorcentajeCapacidad" class="block text-sm font-medium text-gray-700 mb-1">Porcentaje (%)</label>
        <input type="number" name="tapePorcentajeCapacidad" placeholder="Salario Embargable" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapePorcentajeCapacidad" readonly>
    </div>
    <div class="flex-1 mb-4">
        <label for="tapeSalarioEmbargable" class="block text-sm font-medium text-gray-700 mb-1">Salario Embargable</label>
        <input type="number" name="tapeSalarioEmbargable" placeholder="Salario Embargable" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapeSalarioEmbargable" readonly>
    </div>
    <div class="flex-1 mb-4">
        <label for="tapeCapacidadMaximaEmbargo" class="block text-sm font-medium text-gray-700 mb-1">Capacidad Maxima de Embargo</label>
        <input type="number" name="tapeCapacidadMaximaEmbargo" placeholder="Capacidad Maxima de Embargo" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapeCapacidadMaximaEmbargo" readonly>
    </div>
    
</div>
<h3 class="text-lg leading-6 mb-2 font-medium text-gray-900">ANÁLISIS DE HIPOTECAS PAGO VOLUNTARIO O DESCUENTO DIRECTO PARCIAL</h3>
<div class="flex space-x-4" id="sectionAnalisisHipotecas">
    <div class="flex-1 mb-4">
        <label for="tapePagoHipoteca1" class="block text-sm font-medium text-gray-700 mb-1">Pago de Hipoteca 1</label>
        <input type="number" name="tapePagoHipoteca1" placeholder="Pago de Hipoteca 1" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapePagoHipoteca1" readonly>
    </div>
    <div class="flex-1 mb-4">
        <label for="tapePagoHipoteca2" class="block text-sm font-medium text-gray-700 mb-1">Pago de Hipoteca 2</label>
        <input type="number" name="tapePagoHipoteca2" placeholder="Pago de Hipoteca 2" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapePagoHipoteca2" readonly>
    </div>
    <div class="flex-1 mb-4">
        <label for="tapeAnalisis" class="block text-sm font-medium text-gray-700 mb-1">Análisis</label>
        <input type="number" name="tapeAnalisis" placeholder="Análisis" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 text-center" step="0.01" id="tapeAnalisis" readonly>
    </div>
</div>

<script>
    document.getElementById('calcularTapeBtn').addEventListener('click', function() {
        // Obtener el valor de cartera (puedes ajustar el id según tu input real)
        const cartera = document.getElementById('tapeCartera').value.trim().toUpperCase();
        const periodo = document.getElementById('tapPeriodoLetra').value.trim().toUpperCase();
        console.log('Cartera:', cartera,'Periodo: ',periodo);
        // Diccionario de porcentajes por cartera
        const porcentajes = {
            'CONTRALORÍA': 35,
            'EMP. CSS': 35,
            'AUTÓNOMAS': 35,
            'ACP': 50,
            'JUBILADO CSS': 50,
            'EMP. PRIVADA': 20,
            'JUBILADO DE LA ZONA': 0,
            'JUBI ACTIVO CONTRALORIA': 35,
            'JUBI ACTIVO CSS': 35,
            'JUBILADO CONTRALORIA': 50,
            'JUBI ACTIVO AUTÓNOMA': 35,
            'JUBILADO RIESGOS PROF. CSS': 50,
            'INDEPENDIENTE': 0
        };

        // Buscar el porcentaje correspondiente
        let porcentaje = porcentajes[cartera] !== undefined ? porcentajes[cartera] : 0;
        console.log('Porcentaje:', porcentaje);
        const salario = document.getElementById('tapeSalarioBrutoMensual') ? document.getElementById('tapeSalarioBrutoMensual').value : 0;
        var salarioPorcentaje = 0;
        if (cartera !== 'ACP') {
            salarioPorcentaje = ((salario * porcentaje) / 100).toFixed(2);
        }


        document.getElementById('tapeSalarioPorcentaje').value = salarioPorcentaje;
        document.getElementById('tapePorcentaje1').value = porcentaje;
        
        
        var totalDeducciones = calculateTotalDedducciones();
        console.log('Total Deducciones:', totalDeducciones);


        // Calcular el total disponible quincenal
        console.log('--------DISPONIBLE QUINCENAL--------');
        var totalQuincenal = '-';
        if (cartera === 'ACP') {
            var tapeCapacidad50 = document.getElementById('tapeCapacidad50') ? document.getElementById('tapeCapacidad50').value : 0;
            totalQuincenal = tapeCapacidad50;
        } else if (periodo === 'QUINCENAL') {
            totalQuincenal = parseFloat(salarioPorcentaje) - parseFloat(totalDeducciones);
            totalQuincenal = totalQuincenal.toFixed(2);
        } else if (periodo === 'MENSUAL') {
            totalQuincenal = (parseFloat(salarioPorcentaje) - parseFloat(totalDeducciones)) / 2;
            totalQuincenal = totalQuincenal.toFixed(2);
        }
        console.log('Total Quincenal:', totalQuincenal);
       document.getElementById('tapeDisponibleQuincenal').value = totalQuincenal;
        //----------------------------------------------------------------------------
        // Calculo Analisis de Capacidad de Descuento por Embargo
    if (cartera === 'JUBILADO CSS' || cartera === 'JUBILADO DE LA ZONA' || cartera === 'JUBILADO CONTRALORIA' || cartera === 'JUBILADO RIESGOS PROF. CSS') {
        porcentaje = 0;
    } else {
        porcentaje = 15;
    }
    document.getElementById('tapePorcentajeCapacidad').value = porcentaje;
    const montoInembargable = document.getElementById('tapeMontoInembargable') ? document.getElementById('tapeMontoInembargable').value : 0;
    const tapeSalarioBrutoMensual = document.getElementById('tapeSalarioBrutoMensual') ? document.getElementById('tapeSalarioBrutoMensual').value : 0;
    if (porcentaje === 0){
        var tapeSalarioEmbargable = 0;
        var tapeCapacidadMaximaEmbargo = 0;
    }else{
        var tapeSalarioEmbargable = (parseFloat(tapeSalarioBrutoMensual) - parseFloat(montoInembargable)).toFixed(2);
        var tapeCapacidadMaximaEmbargo = ((parseFloat(tapeSalarioEmbargable) * parseFloat(porcentaje)) / 100);
        if (periodo === 'MENSUAL') {
            tapeCapacidadMaximaEmbargo = tapeCapacidadMaximaEmbargo / 2;
        }
        tapeCapacidadMaximaEmbargo = tapeCapacidadMaximaEmbargo.toFixed(2);
    }
    console.log('tapeSalarioEmbargable:', tapeSalarioEmbargable,' tapeCapacidadMaximaEmbargo:', tapeCapacidadMaximaEmbargo);
    document.getElementById('tapeSalarioEmbargable').value = tapeSalarioEmbargable;
    document.getElementById('tapeCapacidadMaximaEmbargo').value = tapeCapacidadMaximaEmbargo;

    //----------------------------------------------------------------------------

        // Calculo Analisis de Salario Minimo por Ley
        var tapeLimiteConHipoteca = document.getElementById('tapeLimiteConHipoteca') ? document.getElementById('tapeLimiteConHipoteca').value : 0;
        var tapeLimiteSinHipoteca = document.getElementById('tapeLimiteSinHipoteca') ? document.getElementById('tapeLimiteSinHipoteca').value : 0;
        // Si Jubilado CSS, Jubilado de la Zona, Jubilado Contraloria, Jubilado riesgo profesional CSS, usa N/A (0%), de resto 25%
        if (cartera === 'JUBILADO CSS' || cartera === 'JUBILADO DE LA ZONA' || cartera === 'JUBILADO CONTRALORIA' || cartera === 'JUBILADO RIESGOS PROF. CSS') {
            porcentaje = 0;
        } else {
            porcentaje = 25;
        }
        var salarioPorcentajeLey;
        if (cartera === 'ACP') {
             console.log('tapeLimiteConHipoteca:', tapeLimiteConHipoteca, ' tapeLimiteSinHipoteca:', tapeLimiteSinHipoteca);
            salarioPorcentajeLey = (parseFloat(tapeLimiteConHipoteca) - parseFloat(tapeLimiteSinHipoteca)).toFixed(2);
        } else {
            salarioPorcentajeLey = ((salario * porcentaje) / 100).toFixed(2);
        }
        console.log('Porcentaje Ley: ', porcentaje, 'Salario Porcentaje Ley:', salarioPorcentajeLey);
        document.getElementById('tapePorcentajeMinimoLey').value = porcentaje;
        document.getElementById('tapeSalarioMinimoLey').value = salarioPorcentajeLey;
        // Resultado final salario minimo por ley
        //-------------------------------------------------------------
        console.log('--------SALARIO MINIMO POR LEY--------');
        var tapeSalarioMinimoPorLey = 0;
        var tapeLetraPrestamo = document.getElementById('tapeLetraPrestamo') && document.getElementById('tapeLetraPrestamo').value.trim() !== '' 
            ? document.getElementById('tapeLetraPrestamo').value 
            : 0;
       
        var tapeSalarioNetoMensual = document.getElementById('tapeSalarioNetoMensual') && document.getElementById('tapeSalarioNetoMensual').value.trim() !== '' 
            ? document.getElementById('tapeSalarioNetoMensual').value 
            : 0;
        var totalCancelaciones  = calculateTotalCancelaciones();
        
        console.log('Salario Neto Mensual:', tapeSalarioNetoMensual);
        console.log('tapeLetraPrestamo:', tapeLetraPrestamo);
        console.log('Salario x Porcentaje:', salarioPorcentajeLey);


        if (porcentaje === 0) {
            tapeSalarioMinimoPorLey = 0;
        } else {
            if (cartera === 'ACP') {
            tapeUtilizado = document.getElementById('tapeUtilizado') ? document.getElementById('tapeUtilizado').value : 0;
            tapeSalarioMinimoPorLey = (parseFloat(tapeLimiteSinHipoteca)*2) - tapeUtilizado + totalCancelaciones - salarioPorcentajeLey - tapeCapacidadMaximaEmbargo  - tapeLetraPrestamo;
            } else {
            if (periodo === 'QUINCENAL') {
                // No calculation provided for QUINCENAL, keep as is or add logic if needed
                tapeSalarioMinimoPorLey = parseFloat(tapeSalarioNetoMensual) + parseFloat(totalCancelaciones) - parseFloat(salarioPorcentajeLey) - parseFloat(tapeLetraPrestamo);
            } else {
                // MENSUAL
                tapeSalarioMinimoPorLey = parseFloat(tapeSalarioNetoMensual) + parseFloat(totalCancelaciones) - parseFloat(salarioPorcentajeLey) - parseFloat(tapeLetraPrestamo);
                tapeSalarioMinimoPorLey = tapeSalarioMinimoPorLey / 2;
            }
            }
        }
       
        
        

        document.getElementById('tapeSalarioMinimoPorLey').value = tapeSalarioMinimoPorLey.toFixed(2);
        console.log('tapeSalarioMinimoPorLey:', tapeSalarioMinimoPorLey);
        console.log('---------------------------------------');
    //----------------------------------------------------------------------------
    
        // Calculo Analisis de Hipotecas
    const letraHipoteca1 = document.getElementById('letraHipoteca1') ? document.getElementById('letraHipoteca1').value : 0;
    const letraHipoteca2 = document.getElementById('letraHipoteca2') ? document.getElementById('letraHipoteca2').value : 0;
    var totalHipoteca = parseFloat(letraHipoteca1) + parseFloat(letraHipoteca2);
    console.log('Letra Hipoteca 1:', letraHipoteca1);
    console.log('Letra Hipoteca 2:', letraHipoteca2);
    document.getElementById('tapePagoHipoteca1').value = letraHipoteca1;
    document.getElementById('tapePagoHipoteca2').value = letraHipoteca2;
    var tapeAnalisis = 0;

    if (parseFloat(letraHipoteca1) === 0 && parseFloat(letraHipoteca2) === 0) {
        tapeAnalisis = 0;
    }else{
        if (cartera === 'JUBILADO CSS' || cartera === 'JUBILADO CONTRALORIA' || cartera === 'JUBILADO RIESGOS PROF. CSS') {

        }else{
            console.log('tapeSalarioMinimoPorLey:', tapeSalarioMinimoPorLey,' totalHipoteca:', totalHipoteca);
            tapeAnalisis = tapeSalarioMinimoPorLey - totalHipoteca;
        }

    }
    console.log('tapeAnalisis:', tapeAnalisis);
    document.getElementById('tapeAnalisis').value = tapeAnalisis;

    });
</script>