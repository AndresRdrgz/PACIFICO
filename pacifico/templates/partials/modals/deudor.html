<div id="deudorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden" style="z-index: 51;">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
        <div class="mt-3 max-h-[80vh] overflow-y-auto">
            <div class="flex space-x-4 justify-between">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Detalles del Deudor</h3>
                <button type="button" class="text-gray-500 hover:text-gray-700" onclick="closedeudorModal()">×</button>
            </div>
        <!--  Inicio contenido-->
        <div id="sectionDetallesDeudor" class="flex-1 p-4 rounded-lg mb-2">
            <!-- Form Elements -->
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="id_tiempoServicio" class="block text-sm font-medium text-gray-700 mb-1">Tiempo de Servicio</label>
                    {{ form.tiempoServicio }}
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_ingresos" class="block text-sm font-medium text-gray-700 mb-1">Ingresos</label>
                    {{ form.ingresos }}
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="id_nombreEmpresa" class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Empresa</label>
                    {{ form.nombreEmpresa }}
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_referenciasAPC" class="block text-sm font-medium text-gray-700 mb-1">Referencias APC</label>
                    {{ form.referenciasAPC }}
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="cartera" class="block text-sm font-medium text-gray-700 mb-1">Cartera</label>
                    <input type="text" id="cartera" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2" readonly>
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_licencia" class="block text-sm font-medium text-gray-700 mb-1">Licencia de Conducir</label>
                    {{ form.licencia }}
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="id_posicion" class="block text-sm font-medium text-gray-700 mb-1">Posición</label>
                    {{ form.posicion }}
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_perfilUniversitario" class="block text-sm font-medium text-gray-700 mb-1">Perfil / Título Universitario</label>
                    {{ form.perfilUniversitario }}
                </div>
            </div>


            <!--Nivel de Endeudamiento-->
            <h3 class="text-lg leading-6 font-medium text-gray-900">Nivel de Endeudamiento</h3>
            <div id="sectionNivelEndeudamiento" class="flex-1 p-1 rounded-lg">
                <!--DEUDOR-->
                <div class="flex-1 mb-4">
                    <label for="id_salarioBaseMensual" class="block text-sm font-medium text-gray-700 mb-1">Salario Base Mensual</label>
                    {{ form.salarioBaseMensual }}
                </div>
                <div class="mb-4">
                    <label for="nivelEndeudamiento" class="block text-sm font-medium text-gray-700 mb-1">Nivel de Endeudamiento (%)</label>
                    %{{resultado.porSalarioNeto}}
                </div>
                
                <table class="min-w-full divide-y divide-gray-200 border" id="tableIngresosAdicionales">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">Ingresos Adicionales</th>
                            <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">Monto Mensual</th>
                            <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">Aplica Dcto. Legal</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Horas extras</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.horasExtrasMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.horasExtrasDcto}}
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Prima de producción</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.primaMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.primaDcto}}
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Bonos</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.bonosMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.bonosDcto}}
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Otros</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.otrosMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.otrosDcto}}
                            </td>
                        </tr>
                    </tbody>
                    <tfoot class="bg-gray-50">
                        <tr>
                            <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">Total</td>
                            <td id="id_totalIngresosAdicionales" class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">
                                {{form.totalIngresosAdicionales}}
                            </td>
                            <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider"></td>
                        </tr>
                    </tfoot>
                </table>

                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mt-10">
                    <div class="flex-1">
                        <!--DESCUENTOS DIRECTO-->
                        <h1 class="text-lg font-bold mb-2 text-center">Descuentos Directos</h1>
                        <table class="min-w-full divide-y divide-gray-200 border" id="tableDescuentoDirecto">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">DESCRIPCIÓN</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">MONTO MENSUAL</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">¿ES PAGADO?</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">SIACAP</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.siacapMonto}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.siacapDcto}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">PRAA</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.praaMonto}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.praaDcto}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros1}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto1}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto1}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros2}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto2}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto2}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros3}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto3}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto3}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros4}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto4}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto4}}
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot class="bg-gray-50">
                                <tr>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">Total</td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">
                                        
                                    </td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="flex-1">
                        <!--PAGOS VOLUNTARIOS-->
                        <h1 class="text-lg font-bold mb-2 text-center">Pagos Voluntarios</h1>
                        <table class="min-w-full divide-y divide-gray-200 border"  id="tablePagosVoluntarios">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">DESCRIPCIÓN</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">MONTO MENSUAL</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">¿ES PAGADO?</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario1}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto1}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto1}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario2}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto2}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto2}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario3}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto3}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto3}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario4}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto4}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto4}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario5}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto5}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto5}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario6}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto6}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto6}}
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot class="bg-gray-50">
                                <tr>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">Total</td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">
                                        
                                    </td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!--Fin Nivel-->


           
        </div>


        <!--Boton guardado-->
        <div class="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2">
            <button type="button" class="inline-flex text-white items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 bg-black text-primary-foreground hover:bg-black/90 h-10 px-4 py-2" onclick="closedeudorModal()">Guardar</button>
        </div>
        </div>
        </div>
    </div>
</div>



<script>
    function openDeudorModal() {
        document.getElementById('deudorModal').classList.remove('hidden');
    }
    function closedeudorModal() {
        document.getElementById('deudorModal').classList.add('hidden');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const ingresosInput = document.getElementById('id_ingresos');
        const salarioBaseMensualInput = document.getElementById('id_salarioBaseMensual');
        const prorrateoSalarioInput = document.getElementById('prorrateoSalario');
    
        if (ingresosInput) {
            ingresosInput.addEventListener('input', function() {
                const ingresos = parseFloat(ingresosInput.value) || 0;
                console.log("Ingresos:", ingresos);
    
                prorrateoSalarioInput.value = ingresos;
                salarioBaseMensualInput.value = ingresos;
    
                console.log("Prorrateo Salario:", prorrateoSalarioInput.value);
                console.log("Salario Base Mensual:", salarioBaseMensualInput.value);
            });
        }
    });

     //Function to calculate the values of 2nd column in the table with id="tableIngresosAdicionales"
     function calculateTotalIngresosAdicionales() {
        const table = document.getElementById('tableIngresosAdicionales');
        const rows = table.getElementsByTagName('tr');
        let total = 0;
        for (let i = 1; i < rows.length - 1; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName('td');
            const monto = parseFloat(cells[1].getElementsByTagName('input')[0].value) || 0;
            total += monto;
        }
        rows[rows.length - 1].getElementsByTagName('td')[1].textContent = total;
        console.log("Total:", total);
        total = total.toFixed(2);
        document.getElementById('id_totalIngresosAdicionales').value = total;

        
        console.log("Total:", total);
        return total;
    }
    
    function calculateTotalDescuentoDirecto() {
        const table = document.getElementById('tableDescuentoDirecto');
        const rows = table.getElementsByTagName('tr');
        let total = 0;
        for (let i = 1; i < rows.length - 1; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName('td');
            const monto = parseFloat(cells[1].getElementsByTagName('input')[0].value) || 0;
            total += monto;
        }
        rows[rows.length - 1].getElementsByTagName('td')[1].textContent = total;
        console.log("Total:", total);
        return total;
    }
    function calculatetotalPagosVoluntarios() {
        const table = document.getElementById('tablePagosVoluntarios');
        const rows = table.getElementsByTagName('tr');
        let total = 0;
        for (let i = 1; i < rows.length - 1; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName('td');
            const monto = parseFloat(cells[1].getElementsByTagName('input')[0].value) || 0;
            total += monto;
        }
        rows[rows.length - 1].getElementsByTagName('td')[1].textContent = total;
        console.log("Total:", total);
        return total;
    }
    function calculateNivelDeEndeudamiento(){
        var cartera = document.getElementById('id_cartera').value;
        const salarioBaseMensual = parseFloat(document.getElementById('id_salarioBaseMensual').value) || 0;
        var totalIngresosAdicionales = 0
        var totalDescuentosDirectos = 0
        var totalPagosVoluntarios = 0
        var totalDescuentosLegales = 0
        var letraMensual = 468.78
        var impuestoSobreLaRenta = 0
        var seguroEducativo = 0
        var seguroSocial = 0 
        var auxISR15 = 0
        var auxISR25 = 0
        totalIngresosAdicionales = calculateTotalIngresosAdicionales()
        totalDescuentosDirectos = calculateTotalDescuentoDirecto()
        totalPagosVoluntarios = calculatetotalPagosVoluntarios()

        totalIngresosMensuales = salarioBaseMensual + totalIngresosAdicionales
        console.log("Total Ingresos Mensuales:", totalIngresosMensuales)
        
        //SEGURO SOCIAL
        if (cartera == 'INDEPENDIENTE'){
            seeguroSocial = 0
        }else{
            if (['JUBILADO RIESGOS PROF. CSS', 'JUBILADO CONTRALORIA', 'JUBILADO DE LA ZONA', 'JUBILADO CSS'].includes(cartera)) {

                seguroSocial = (totalIngresosMensuales*6.75)/100;
                
            
            }else{
                seguroSocial = (totalIngresosMensuales*9.75)/100;
            }

        }
        console.log("Seguro Social:", seguroSocial)
       
       //SEGURO EDUCATIVO
       if (['JUBILADO RIESGOS PROF. CSS', 'JUBILADO CONTRALORIA', 'JUBILADO DE LA ZONA', 'JUBILADO CSS', 'INDEPENDIENTE'].includes(cartera)) {
            seguroEducativo = 0;
        }else{
            seguroEducativo = (totalIngresosMensuales*1.25)/100;
        }

        //IMPUESTO SOBRE LA RENTA
        //
        if (['JUBILADO RIESGOS PROF. CSS', 'JUBILADO CONTRALORIA', 'JUBILADO DE LA ZONA', 'JUBILADO CSS', 'INDEPENDIENTE'].includes(cartera)) {
            impuestoSobreLaRenta = 0;
        }else{
            var salarioAnual = totalIngresosMensuales * 13
            if (salarioAnual < 11000) {
                auxISR15 = 0;
            } else if (salarioAnual >= 11000 && salarioAnual < 50000) {
                auxISR15 = (salarioAnual - 11000) * 0.15;
            } else if (salarioAnual >= 50000) {
                auxISR15 = (50000-11000)*0.15;
                auxISR25 = (salarioAnual - 50000) * 0.25;
            }
            impuestoSobreLaRentaAnual = auxISR15 + auxISR25;
            impuestoSobreLaRenta = impuestoSobreLaRentaAnual / 13;
            //console.log("Impuesto Sobre la Renta:", auxISR15);
            //console.log("Impuesto Sobre la Renta:", auxISR25);
            console.log("Impuesto Sobre la Renta:", impuestoSobreLaRenta);

        }
        console.log("Seguro Educativo:", seguroEducativo)
        //total descuentos totalDescuentosLegales 
        totalDescuentosLegales = impuestoSobreLaRenta + seguroEducativo + seguroSocial;

         //NIVEL REAL
         var granTotalDescontado = totalDescuentosDirectos + totalPagosVoluntarios + totalDescuentosLegales
         console.log("Gran Total Descontado:", granTotalDescontado);
         var salarioNetoActual = totalIngresosMensuales - granTotalDescontado;
         var salarioNeto  = salarioNetoActual - letraMensual;

        console.log("Cartera:", cartera)
        //porcentajes
        var porSalarioNetoActual = (salarioNetoActual / totalIngresosMensuales) * 100
        var porLetraMensual = (letraMensual / totalIngresosMensuales) * 100
        var porSalarioNeto = (salarioNeto / totalIngresosMensuales) * 100

        
        console.log("Salario Neto Actual:", salarioNetoActual)
        console.log("Salario Neto:", salarioNeto)
        console.log("Porcentaje Salario Neto Actual:", porSalarioNetoActual)
        console.log("Porcentaje Letra Mensual:", porLetraMensual)
        console.log("Porcentaje Salario Neto:", porSalarioNeto)

        document.getElementById('salarioNeto').value = salarioNeto.toFixed(2)
        document.getElementById('nivelEndeudamiento').value = porSalarioNeto.toFixed(2);



    }


    //Event Listeners - tablas nivel de endeudamiento
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('#tableIngresosAdicionales input');
        inputs.forEach(function(input) {
            input.addEventListener('input', calculateTotalIngresosAdicionales);
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('#tableDescuentoDirecto input');
        inputs.forEach(function(input) {
            input.addEventListener('input', calculateTotalDescuentoDirecto);
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('#tablePagosVoluntarios input');
        inputs.forEach(function(input) {
            input.addEventListener('input', calculatetotalPagosVoluntarios);
        });
    });


    calculateTotalDescuentoDirecto();
    calculateTotalIngresosAdicionales();
    calculatetotalPagosVoluntarios();



</script>