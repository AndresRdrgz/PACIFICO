<div id="deudorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden" style="z-index: 51;">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
        <div class="mt-3 max-h-[80vh] overflow-y-auto">
            <div class="flex space-x-4 justify-between">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Detalles del Deudor</h3>
                <button type="button" class="text-gray-500 hover:text-gray-700" onclick="closedeudorModal()">×</button>
            </div>
            <div role="tablist" aria-orientation="horizontal" id="tablistNivelEndeudamiento" class="inline-flex h-10 mt-2 items-center justify-center rounded-lg bg-gray-200 p-1 text-gray-600 shadow-md">
                            <button type="button" role="tab" aria-selected="true" aria-controls="sectionDetallesDeudor" data-state="active" id="tab-informacion" class="inline-flex items-center justify-center whitespace-nowrap rounded-md px-4 py-2 text-sm font-medium bg-white text-gray-800 shadow-sm" onclick="showNivelEndeudamientoTab('informacion')">
                                Información
                            </button>
                            <button type="button" role="tab" aria-selected="false" aria-controls="sectionResultado" data-state="inactive" id="tab-resultado" class="inline-flex items-center justify-center whitespace-nowrap rounded-md px-4 py-2 text-sm font-medium bg-gray-200 text-gray-600" onclick="showNivelEndeudamientoTab('resultado')">
                                Resultado
                            </button>
                        </div>
        <!--  Inicio contenido-->
        <div id="sectionDetallesDeudor" class="flex-1 p-4 rounded-lg mb-2">
            <!-- Form Elements -->
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="id_tiempoServicio" class="block text-sm font-medium text-gray-700 mb-1">Tiempo de Servicio</label>
                    {{ form.tiempoServicio }}
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_ingresos" class="block text-sm font-medium text-gray-700 mb-1">Ingresos</label>
                    {{ form.ingresos }}
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="id_nombreEmpresa" class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Empresa</label>
                    {{ form.nombreEmpresa }}
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_referenciasAPC" class="block text-sm font-medium text-gray-700 mb-1">Referencias APC</label>
                    {{ form.referenciasAPC }}
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="cartera" class="block text-sm font-medium text-gray-700 mb-1">Cartera</label>
                    <input type="text" id="cartera" class="w-full bg-gray-100 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2" readonly>
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_licencia" class="block text-sm font-medium text-gray-700 mb-1">Licencia de Conducir</label>
                    {{ form.licencia }}
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="flex-1 mb-4">
                    <label for="id_posicion" class="block text-sm font-medium text-gray-700 mb-1">Posición</label>
                    {{ form.posicion }}
                </div>
                <div class="flex-1 mb-4">
                    <label for="id_perfilUniversitario" class="block text-sm font-medium text-gray-700 mb-1">Perfil / Título Universitario</label>
                    {{ form.perfilUniversitario }}
                </div>
            </div>


            <!--Nivel de Endeudamiento-->
            <h3 class="text-lg leading-6 font-medium text-gray-900">Nivel de Endeudamiento</h3>
            <div id="sectionNivelEndeudamiento" class="flex-1 p-1 rounded-lg">
                <!--DEUDOR-->
                <div class="flex-1 mb-4">
                    <label for="id_salarioBaseMensual" class="block text-sm font-medium text-gray-700 mb-1">Salario Base Mensual</label>
                    {{ form.salarioBaseMensual }}
                </div>
                <div class="mb-4">
                    <label for="nivelEndeudamiento" class="block text-sm font-medium text-gray-700 mb-1">Nivel de Endeudamiento (%)</label>
                    %{{resultado.porSalarioNeto}}
                </div>
                
                <table class="min-w-full divide-y divide-gray-200 border" id="tableIngresosAdicionales">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">Ingresos Adicionales</th>
                            <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">Monto Mensual</th>
                            <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">Aplica Dcto. Legal</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Horas extras</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.horasExtrasMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.horasExtrasDcto}}
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Prima de producción</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.primaMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.primaDcto}}
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Bonos</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.bonosMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.bonosDcto}}
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Otros</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.otrosMonto}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {{form.otrosDcto}}
                            </td>
                        </tr>
                    </tbody>
                    <tfoot class="bg-gray-50">
                        <tr>
                            <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">Total</td>
                            <td id="id_totalIngresosAdicionales" class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">
                                {{form.totalIngresosAdicionales}}
                            </td>
                            <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider"></td>
                        </tr>
                    </tfoot>
                </table>

                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mt-10">
                    <div class="flex-1">
                        <!--DESCUENTOS DIRECTO-->
                        <h1 class="text-lg font-bold mb-2 text-center">Descuentos Directos</h1>
                        <table class="min-w-full divide-y divide-gray-200 border" id="tableDescuentoDirecto">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">DESCRIPCIÓN</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">MONTO MENSUAL</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">¿ES PAGADO?</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">SIACAP</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.siacapMonto}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.siacapDcto}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">PRAA</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.praaMonto}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.praaDcto}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros1}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto1}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto1}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros2}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto2}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto2}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros3}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto3}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto3}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.dirOtros4}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosMonto4}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.dirOtrosDcto4}}
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot class="bg-gray-50">
                                <tr>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">Total</td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">
                                        
                                    </td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="flex-1">
                        <!--PAGOS VOLUNTARIOS-->
                        <h1 class="text-lg font-bold mb-2 text-center">Pagos Voluntarios</h1>
                        <table class="min-w-full divide-y divide-gray-200 border"  id="tablePagosVoluntarios">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">DESCRIPCIÓN</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">MONTO MENSUAL</th>
                                    <th scope="col" class="px-6 py-3 text-xs uppercase bg-black text-white">¿ES PAGADO?</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario1}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto1}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto1}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario2}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto2}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto2}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario3}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto3}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto3}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario4}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto4}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto4}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario5}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto5}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto5}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{form.pagoVoluntario6}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioMonto6}}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{form.pagoVoluntarioDcto6}}
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot class="bg-gray-50">
                                <tr>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">Total</td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider">
                                        
                                    </td>
                                    <td class="px-6 py-3 text-left text-xs font-medium text-black-500 uppercase tracking-wider"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!--Fin Nivel-->


           
        </div>
        <div id="sectionResultado" class="hidden">
            <button type="button" class="px-4 py-2 mt-6 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none" id="calcularNivelBtn" onclick="calculateNivelDeEndeudamiento()">
                Calcular Nivel
            </button>
            <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Ingresos Mensuales</h3>
            <table class="min-w-full divide-y divide-gray-200 border">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Descripción</th>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Nivel Real</th>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Nivel Completo</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center">Salario Mensual</td>
                        <td id="salarioMensualReal" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                        <td id="salarioMensualCompleto" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center">Total Ingresos Adicionales</td>
                        <td id="totalIngresosAdicionalesReal" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                        <td id="totalIngresosAdicionalesCompleto" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Descuentos</h3>
            <table class="min-w-full divide-y divide-gray-200 border">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Descripción</th>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Nivel Real</th>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Nivel Completo</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center">Total - Descuentos Legales</td>
                        <td id="totalDescuentosLegalesReal" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                        <td id="totalDescuentosLegalesCompleto" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center">Total - Descuento Directo</td>
                        <td id="totalDescuentoDirectoReal" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                        <td id="totalDescuentoDirectoCompleto" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center">Total - Pago Voluntario</td>
                        <td id="totalPagoVoluntarioReal" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                        <td id="totalPagoVoluntarioCompleto" class="px-6 py-4 whitespace-nowrap text-center">B/.</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Nivel de Endeudamiento</h3>
            <table class="min-w-full divide-y divide-gray-200 border">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Descripción</th>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Nivel Real</th>
                        <th class="px-6 py-3 text-xs uppercase bg-black text-white text-center">Nivel Completo</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center">Salario Neto Actual</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">B/. (%)</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">B/. (%)</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center">Nueva Letra Mensual</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">B/. (%)</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">B/. (%)</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap font-bold text-red-600 text-center">Salario Neto</td>
                        <td class="px-6 py-4 whitespace-nowrap font-bold text-red-600 text-center">B/.(%)</td>
                        <td class="px-6 py-4 whitespace-nowrap font-bold text-red-600 text-center">B/.(%)</td>
                    </tr>
                </tbody>
            </table>
            <p class="text-sm text-gray-600 mt-2">El nivel real es el que se considera para analizar el crédito; el nivel completo es sólo una de referencia.</p>
        </div>

        <!--Boton guardado-->
        <div class="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2">
            <button type="button" class="inline-flex text-white items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 bg-black text-primary-foreground hover:bg-black/90 h-10 px-4 py-2" onclick="closedeudorModal()">Guardar</button>
        </div>
        </div>
        </div>
    </div>
</div>



<script>
    function openDeudorModal() {
        document.getElementById('deudorModal').classList.remove('hidden');
    }
    function closedeudorModal() {
        document.getElementById('deudorModal').classList.add('hidden');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const ingresosInput = document.getElementById('id_ingresos');
        const salarioBaseMensualInput = document.getElementById('id_salarioBaseMensual');
        const prorrateoSalarioInput = document.getElementById('prorrateoSalario');
        const tapeSalarioBrutoMensualInput = document.getElementById('tapeSalarioBrutoMensual');
    
        if (ingresosInput) {
            ingresosInput.addEventListener('input', function() {
                const ingresos = parseFloat(ingresosInput.value) || 0;
                prorrateoSalarioInput.value = ingresos;
                salarioBaseMensualInput.value = ingresos;
                tapeSalarioBrutoMensualInput.value = ingresos;
            });
        }
    });

    function calculateTotalIngresosAdicionales() {
        const table = document.getElementById('tableIngresosAdicionales');
        const rows = table.getElementsByTagName('tr');
        let total = 0;
        for (let i = 1; i < rows.length - 1; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName('td');
            const monto = parseFloat(cells[1].getElementsByTagName('input')[0].value) || 0;
            total += monto;
        }
        rows[rows.length - 1].getElementsByTagName('td')[1].textContent = total;
        total = total.toFixed(2);
        document.getElementById('id_totalIngresosAdicionales').value = total;
        return total;
    }
    
    function calculateTotalDescuentoDirecto() {
        const table = document.getElementById('tableDescuentoDirecto');
        const rows = table.getElementsByTagName('tr');
        let total = 0;
        for (let i = 1; i < rows.length - 1; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName('td');
            const monto = parseFloat(cells[1].getElementsByTagName('input')[0].value) || 0;
            total += monto;
        }
        rows[rows.length - 1].getElementsByTagName('td')[1].textContent = total;
        return total;
    }
    function calculatetotalPagosVoluntarios() {
        const table = document.getElementById('tablePagosVoluntarios');
        const rows = table.getElementsByTagName('tr');
        let total = 0;
        for (let i = 1; i < rows.length - 1; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName('td');
            const monto = parseFloat(cells[1].getElementsByTagName('input')[0].value) || 0;
            total += monto;
        }
        rows[rows.length - 1].getElementsByTagName('td')[1].textContent = total;
        return total;
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('#tableIngresosAdicionales input').forEach(function(input) {
            input.addEventListener('input', calculateTotalIngresosAdicionales);
        });
        document.querySelectorAll('#tableDescuentoDirecto input').forEach(function(input) {
            input.addEventListener('input', calculateTotalDescuentoDirecto);
        });
        document.querySelectorAll('#tablePagosVoluntarios input').forEach(function(input) {
            input.addEventListener('input', calculatetotalPagosVoluntarios);
        });
        calculateTotalDescuentoDirecto();
        calculateTotalIngresosAdicionales();
        calculatetotalPagosVoluntarios();
    });

    function showNivelEndeudamientoTab(tab) {
        const informacionTab = document.getElementById('tab-informacion');
        const resultadoTab = document.getElementById('tab-resultado');
        const sectionDetallesDeudor = document.getElementById('sectionDetallesDeudor');
        const sectionNivelEndeudamiento = document.getElementById('sectionNivelEndeudamiento');
        const sectionResultado = document.getElementById('sectionResultado');

        if (tab === 'informacion') {
            informacionTab.setAttribute('aria-selected', 'true');
            informacionTab.classList.add('bg-white', 'text-gray-800', 'shadow-sm');
            informacionTab.classList.remove('bg-gray-200', 'text-gray-600');

            resultadoTab.setAttribute('aria-selected', 'false');
            resultadoTab.classList.add('bg-gray-200', 'text-gray-600');
            resultadoTab.classList.remove('bg-white', 'text-gray-800', 'shadow-sm');

            sectionDetallesDeudor.classList.remove('hidden');
            sectionNivelEndeudamiento.classList.remove('hidden');
            sectionResultado.classList.add('hidden');
        } else if (tab === 'resultado') {
            resultadoTab.setAttribute('aria-selected', 'true');
            resultadoTab.classList.add('bg-white', 'text-gray-800', 'shadow-sm');
            resultadoTab.classList.remove('bg-gray-200', 'text-gray-600');

            informacionTab.setAttribute('aria-selected', 'false');
            informacionTab.classList.add('bg-gray-200', 'text-gray-600');
            informacionTab.classList.remove('bg-white', 'text-gray-800', 'shadow-sm');

            sectionDetallesDeudor.classList.add('hidden');
            sectionNivelEndeudamiento.classList.add('hidden');
            sectionResultado.classList.remove('hidden');
        }
    }

    function calculateDescuentosLegales() {
        const carteraInput = document.getElementById('cartera');
        const cartera = carteraInput ? carteraInput.value : '';
        const salarioBaseMensual = parseFloat(document.getElementById('id_salarioBaseMensual').value) || 0;
        let totalIngresosAdicionales = 0;
        try {
            totalIngresosAdicionales =
                (parseFloat(document.getElementById('id_horasExtrasMonto')?.value) || 0) +
                (parseFloat(document.getElementById('id_primaMonto')?.value) || 0) +
                (parseFloat(document.getElementById('id_bonosMonto')?.value) || 0) +
                (parseFloat(document.getElementById('id_otrosMonto')?.value) || 0);
        } catch (e) {
            totalIngresosAdicionales = 0;
        }
        totalIngresosAdicionales = Math.round(totalIngresosAdicionales * 100) / 100;

        const totalIngresosMensuales = salarioBaseMensual;
        const totalIngresosMensualesCompleto = salarioBaseMensual + totalIngresosAdicionales;

        // Seguro Social
        let seguroSocial = 0, seguroSocialCompleto = 0;
        if (cartera === 'INDEPENDIENTE') {
            seguroSocial = 0;
            seguroSocialCompleto = 0;
        } else if (
            [
                'JUBILADO RIESGOS PROF. CSS',
                'JUBILADO CONTRALORIA',
                'JUBILADO DE LA ZONA',
                'JUBILADO CSS'
            ].includes(cartera)
        ) {
            seguroSocial = (totalIngresosMensuales * 6.75) / 100;
            seguroSocialCompleto = (totalIngresosMensualesCompleto * 6.75) / 100;
        } else {
            seguroSocial = (totalIngresosMensuales * 9.75) / 100;
            seguroSocialCompleto = (totalIngresosMensualesCompleto * 9.75) / 100;
        }

        // Seguro Educativo
        let seguroEducativo = 0, seguroEducativoCompleto = 0;
        if (
            [
                'JUBILADO RIESGOS PROF. CSS',
                'JUBILADO CONTRALORIA',
                'JUBILADO DE LA ZONA',
                'JUBILADO CSS',
                'INDEPENDIENTE'
            ].includes(cartera)
        ) {
            seguroEducativo = 0;
            seguroEducativoCompleto = 0;
        } else {
            seguroEducativo = (totalIngresosMensuales * 1.25) / 100;
            seguroEducativoCompleto = (totalIngresosMensualesCompleto * 1.25) / 100;
        }

        // Impuesto Sobre la Renta
        let impuestoSobreLaRenta = 0, impuestoSobreLaRentaCompleto = 0;
        if (
            [
                'JUBILADO RIESGOS PROF. CSS',
                'JUBILADO CONTRALORIA',
                'JUBILADO DE LA ZONA',
                'JUBILADO CSS',
                'INDEPENDIENTE'
            ].includes(cartera)
        ) {
            impuestoSobreLaRenta = 0;
            impuestoSobreLaRentaCompleto = 0;
        } else {
            const salarioAnual = totalIngresosMensuales * 13;
            const salarioAnualCompleto = totalIngresosMensualesCompleto * 13;
            let auxISR15 = 0, auxISR25 = 0, auxISR15Completo = 0, auxISR25Completo = 0;
            if (salarioAnual < 11000) {
                auxISR15 = 0;
                auxISR25 = 0;
                auxISR15Completo = 0;
                auxISR25Completo = 0;
            } else if (salarioAnual >= 11000 && salarioAnual < 50000) {
                auxISR15 = (salarioAnual - 11000) * 0.15;
                auxISR25 = 0;
                auxISR15Completo = (salarioAnualCompleto - 11000) * 0.15;
                auxISR25Completo = 0;
            } else {
                auxISR15 = (50000 - 11000) * 0.15;
                auxISR25 = (salarioAnual - 50000) * 0.25;
                auxISR15Completo = (50000 - 11000) * 0.15;
                auxISR25Completo = (salarioAnualCompleto - 50000) * 0.25;
            }
            const impuestoSobreLaRentaAnual = auxISR15 + auxISR25;
            impuestoSobreLaRenta = impuestoSobreLaRentaAnual / 13;
            const impuestoSobreLaRentaAnualCompleto = auxISR15Completo + auxISR25Completo;
            impuestoSobreLaRentaCompleto = impuestoSobreLaRentaAnualCompleto / 13;
        }

        let totalDescuentosLegales = seguroSocial + seguroEducativo + impuestoSobreLaRenta;
        totalDescuentosLegales = Math.round(totalDescuentosLegales * 100) / 100;
        let totalDescuentosLegalesCompleto = seguroSocialCompleto + seguroEducativoCompleto + impuestoSobreLaRentaCompleto;
        totalDescuentosLegalesCompleto = Math.round(totalDescuentosLegalesCompleto * 100) / 100;

        return {
            totalDescuentosLegales,
            totalDescuentosLegalesCompleto
        };
    }

    function calculateNivelDeEndeudamiento() {
        // Get Salario Base Mensual
        const salarioBaseMensualInput = document.getElementById('id_salarioBaseMensual');
        const salarioBaseMensual = parseFloat(salarioBaseMensualInput.value) || 0;
        document.getElementById('salarioMensualReal').textContent = `B/.${salarioBaseMensual.toFixed(2)}`;
        document.getElementById('salarioMensualCompleto').textContent = `B/.${salarioBaseMensual.toFixed(2)}`;
       

        // Get values from the 'Ingresos Adicionales' table
        const ingresosTable = document.getElementById('tableIngresosAdicionales');
        const ingresosRows = ingresosTable.getElementsByTagName('tr');
        let totalIngresosAdicionales = 0;
        for (let i = 1; i < ingresosRows.length - 1; i++) {
            const cell = ingresosRows[i].getElementsByTagName('td')[1];
            let monto = 0;
            const input = cell.querySelector('input');
            if (input) {
                monto = parseFloat(input.value) || 0;
            } else {
                monto = parseFloat(cell.textContent) || 0;
            }
            totalIngresosAdicionales += monto;
        }

        // Get values from the 'Descuentos Legales' section
        const { totalDescuentosLegales, totalDescuentosLegalesCompleto } = calculateDescuentosLegales();

        // Get values from the 'Descuentos Directos' table
        const descuentosTable = document.getElementById('tableDescuentoDirecto');
        const descuentosRows = descuentosTable.getElementsByTagName('tr');
        let totalDescuentosDirectos = 0;
        for (let i = 1; i < descuentosRows.length - 1; i++) {
            const cell = descuentosRows[i].getElementsByTagName('td')[1];
            let monto = 0;
            const input = cell.querySelector('input');
            if (input) {
                monto = parseFloat(input.value) || 0;
            } else {
                monto = parseFloat(cell.textContent) || 0;
            }
            totalDescuentosDirectos += monto;
        }

        // Get values from the 'Pagos Voluntarios' table
        const pagosTable = document.getElementById('tablePagosVoluntarios');
        const pagosRows = pagosTable.getElementsByTagName('tr');
        let totalPagosVoluntarios = 0;
        for (let i = 1; i < pagosRows.length - 1; i++) {
            const cell = pagosRows[i].getElementsByTagName('td')[1];
            let monto = 0;
            const input = cell.querySelector('input');
            if (input) {
                monto = parseFloat(input.value) || 0;
            } else {
                monto = parseFloat(cell.textContent) || 0;
            }
            totalPagosVoluntarios += monto;
        }

        // Real: solo salario base mensual
        const totalIngresosReal = salarioBaseMensual;
        const totalDescuentosReal = totalDescuentosLegales + totalDescuentosDirectos + totalPagosVoluntarios;
        const salarioNetoReal = totalIngresosReal - totalDescuentosReal;

        // Completo: salario base + ingresos adicionales
        const totalIngresosCompleto = salarioBaseMensual + totalIngresosAdicionales;
        const totalDescuentosCompleto = totalDescuentosLegalesCompleto + totalDescuentosDirectos + totalPagosVoluntarios;
        const salarioNetoCompleto = totalIngresosCompleto - totalDescuentosCompleto;

        // Nueva Letra Mensual (hardcoded, replace as needed)
        const nuevaLetraMensual = document.getElementById('tapeLetraPrestamo').value ? parseFloat(document.getElementById('tapeLetraPrestamo').value) : 0;
        const finalNetSalaryReal = salarioNetoReal - nuevaLetraMensual;
        const finalNetSalaryCompleto = salarioNetoCompleto - nuevaLetraMensual;

        // Update the Resultado section
        document.getElementById('salarioMensualReal').textContent = `B/.${salarioBaseMensual.toFixed(2)}`;
        
        document.getElementById('totalIngresosAdicionalesReal').textContent = `B/.0.00`;
        document.getElementById('totalIngresosAdicionalesCompleto').textContent = `B/.${totalIngresosAdicionales.toFixed(2)}`;
        document.getElementById('totalDescuentosLegalesReal').textContent = `B/.${totalDescuentosLegales.toFixed(2)}`;
        document.getElementById('totalDescuentosLegalesCompleto').textContent = `B/.${totalDescuentosLegalesCompleto.toFixed(2)}`;
        document.getElementById('totalDescuentoDirectoReal').textContent = `B/.${totalDescuentosDirectos.toFixed(2)}`;
        document.getElementById('totalDescuentoDirectoCompleto').textContent = `B/.${totalDescuentosDirectos.toFixed(2)}`;
        document.getElementById('totalPagoVoluntarioReal').textContent = `B/.${totalPagosVoluntarios.toFixed(2)}`;
        document.getElementById('totalPagoVoluntarioCompleto').textContent = `B/.${totalPagosVoluntarios.toFixed(2)}`;

        // Nivel de Endeudamiento table
        const resultadoTable = document.querySelector('#sectionResultado table:nth-of-type(3) tbody');
        const rows = resultadoTable.getElementsByTagName('tr');

        // Salario Neto Actual
        rows[0].getElementsByTagName('td')[1].textContent = `B/.${salarioNetoReal.toFixed(2)} (${((salarioNetoReal / totalIngresosReal) * 100 || 0).toFixed(0)}%)`;
        rows[0].getElementsByTagName('td')[2].textContent = `B/.${salarioNetoCompleto.toFixed(2)} (${((salarioNetoCompleto / totalIngresosCompleto) * 100 || 0).toFixed(0)}%)`;

        // Nueva Letra Mensual
        rows[1].getElementsByTagName('td')[1].textContent = `B/.${nuevaLetraMensual.toFixed(2)} (${((nuevaLetraMensual / totalIngresosReal) * 100 || 0).toFixed(0)}%)`;
        rows[1].getElementsByTagName('td')[2].textContent = `B/.${nuevaLetraMensual.toFixed(2)} (${((nuevaLetraMensual / totalIngresosCompleto) * 100 || 0).toFixed(0)}%)`;

        // Salario Neto
        rows[2].getElementsByTagName('td')[1].textContent = `B/.${finalNetSalaryReal.toFixed(2)} (${((finalNetSalaryReal / totalIngresosReal) * 100 || 0).toFixed(0)}%)`;
        rows[2].getElementsByTagName('td')[2].textContent = `B/.${finalNetSalaryCompleto.toFixed(2)} (${((finalNetSalaryCompleto / totalIngresosCompleto) * 100 || 0).toFixed(0)}%)`;
        
        // Setear valor Salario Neto Mensual
        document.getElementById('tapeSalarioNetoMensual').value = salarioNetoReal.toFixed(2);
    
    }
</script>
